<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Athena - Admin Dashboard</title>

    <!-- Google Fonts - Inter and JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- Chart.js for sparklines and histograms -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#0f0f0f',
                            card: '#1a1a1a',
                            border: '#333',
                            sidebar: '#1a1f2e',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* ============================================
           DESIGN TOKENS - MUST BE FIRST
           All layout CSS depends on these variables
           ============================================ */

        :root {
            /* Colors - Background */
            --color-bg: #0f0f0f;
            --color-card: #1a1a1a;
            --color-sidebar: #1a1f2e;
            --color-elevated: #242424;

            /* Colors - Border */
            --color-border: #333333;
            --color-border-hover: #444444;
            --color-border-focus: #3b82f6;

            /* Colors - Text */
            --color-text: #e5e7eb;
            --color-text-secondary: #9ca3af;
            --color-muted: #6b7280;

            /* Colors - Primary (Blue) */
            --color-primary: #3b82f6;
            --color-primary-light: #60a5fa;
            --color-primary-dark: #2563eb;
            --color-primary-bg: rgba(59, 130, 246, 0.1);
            --color-primary-bg-hover: rgba(59, 130, 246, 0.15);

            /* Colors - Success (Green) */
            --color-success: #22c55e;
            --color-success-light: #4ade80;
            --color-success-dark: #16a34a;
            --color-success-bg: rgba(34, 197, 94, 0.1);

            /* Colors - Warning (Yellow/Orange) */
            --color-warning: #f59e0b;
            --color-warning-light: #fbbf24;
            --color-warning-dark: #d97706;
            --color-warning-bg: rgba(245, 158, 11, 0.1);

            /* Colors - Error (Red) */
            --color-error: #ef4444;
            --color-error-light: #f87171;
            --color-error-dark: #dc2626;
            --color-error-bg: rgba(239, 68, 68, 0.1);

            /* Colors - Purple (Special) */
            --color-purple: #8b5cf6;
            --color-purple-light: #a78bfa;
            --color-purple-dark: #7c3aed;
            --color-purple-bg: rgba(139, 92, 246, 0.1);

            /* Focus */
            --color-focus: #60a5fa;

            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;

            /* Border Radius */
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.5);

            /* Button Shadows */
            --shadow-btn-primary: 0 4px 14px rgba(59, 130, 246, 0.25);
            --shadow-btn-success: 0 4px 14px rgba(34, 197, 94, 0.25);
            --shadow-btn-danger: 0 4px 14px rgba(239, 68, 68, 0.25);

            /* Glow Effects */
            --glow-primary: 0 0 20px rgba(59, 130, 246, 0.3);
            --glow-success: 0 0 20px rgba(34, 197, 94, 0.3);
            --glow-error: 0 0 20px rgba(239, 68, 68, 0.3);

            /* Transitions */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.2s ease;
            --transition-slow: 0.3s ease;

            /* Typography */
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-mono: 'JetBrains Mono', 'Monaco', 'Courier New', monospace;

            /* Z-Index Scale */
            --z-dropdown: 50;
            --z-sticky: 60;
            --z-modal-backdrop: 90;
            --z-modal: 100;
            --z-tooltip: 110;
            --z-toast: 120;
        }

        /* Backdrop-filter fallback for unsupported browsers */
        @supports not (backdrop-filter: blur(10px)) {
            :root {
                --color-card: #1f1f1f;
                --color-sidebar: #1f2937;
            }
        }

        /* ============================================
           BASE STYLES
           ============================================ */

        body {
            font-family: var(--font-sans);
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .sidebar-item-active {
            background-color: rgba(59, 130, 246, 0.1);
            border-left: 3px solid #3b82f6;
            color: #60a5fa;
        }
        .sidebar-item:hover:not(.sidebar-item-active) {
            background-color: rgba(255, 255, 255, 0.05);
        }
        .main-content {
            height: calc(100vh - 60px);
            overflow-y: auto;
        }
        .sidebar {
            width: 72px;
            min-width: 72px;
            height: calc(100vh - 60px);
            overflow-y: auto;
            overflow-x: hidden;
            transition: width 0.2s ease;
        }
        .sidebar:hover,
        .sidebar.expanded {
            width: 240px;
        }
        .sidebar .sidebar-item span:not(.sidebar-icon) {
            opacity: 0;
            white-space: nowrap;
            transition: opacity 0.15s ease;
        }
        .sidebar:hover .sidebar-item span:not(.sidebar-icon),
        .sidebar.expanded .sidebar-item span:not(.sidebar-icon) {
            opacity: 1;
        }
        .sidebar-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }
        .sidebar-category-header {
            opacity: 0;
            transition: opacity 0.15s ease;
        }
        .sidebar:hover .sidebar-category-header,
        .sidebar.expanded .sidebar-category-header {
            opacity: 1;
        }
        @media (prefers-reduced-motion: reduce) {
            .sidebar {
                transition: none;
            }
        }
        /* Custom scrollbar */
        .sidebar::-webkit-scrollbar, .main-content::-webkit-scrollbar {
            width: 8px;
        }
        .sidebar::-webkit-scrollbar-track, .main-content::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        .sidebar::-webkit-scrollbar-thumb, .main-content::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }
        .sidebar::-webkit-scrollbar-thumb:hover, .main-content::-webkit-scrollbar-thumb:hover {
            background: #444;
        }

        /* Collapsible sidebar categories */
        .sidebar-category {
            cursor: pointer;
            user-select: none;
        }
        .sidebar-category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 1rem;
            margin-top: 0.5rem;
            transition: background-color 0.2s;
        }
        .sidebar-category-header:hover {
            background-color: rgba(255, 255, 255, 0.03);
        }
        .sidebar-category-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .sidebar-category-chevron {
            font-size: 0.75rem;
            color: #6b7280;
            transition: transform 0.2s ease;
        }
        .sidebar-category.collapsed .sidebar-category-chevron {
            transform: rotate(-90deg);
        }
        .sidebar-category-items {
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.2s ease;
            max-height: 1000px;
            opacity: 1;
        }
        .sidebar-category.collapsed .sidebar-category-items {
            max-height: 0;
            opacity: 0;
        }

        /* Metrics page styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .stat-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 0.5rem;
            padding: 1.5rem;
        }
        .stat-label {
            font-size: 0.875rem;
            color: #9ca3af;
            margin-bottom: 0.5rem;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #60a5fa;
        }
        .stats-breakdown {
            margin-top: 1.5rem;
        }
        .stats-breakdown h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
            margin-top: 1.5rem;
        }
        .stats-breakdown h3:first-child {
            margin-top: 0;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        .data-table thead {
            background: #0f0f0f;
        }
        .data-table th {
            padding: 0.75rem 1rem;
            text-align: left;
            color: #9ca3af;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }
        .data-table th > span {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        /* Generic table header fix for all tables */
        table th {
            white-space: nowrap;
        }
        table th > span {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        .data-table td {
            padding: 0.75rem 1rem;
            border-top: 1px solid #333;
            color: #d1d5db;
        }
        .data-table tbody tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }
        .metric-value {
            font-family: 'Monaco', 'Courier New', monospace;
            font-weight: 600;
            color: #60a5fa;
        }
        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .tag-model {
            background: rgba(147, 51, 234, 0.2);
            color: #c084fc;
        }
        .tag-backend {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }
        .tag-source {
            background: rgba(251, 146, 60, 0.2);
            color: #fb923c;
        }
        .session-id {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.75rem;
            color: #9ca3af;
        }
        .chart {
            width: 100%;
        }
        .chart h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
        }
        .chart-bars {
            display: flex;
            align-items: flex-end;
            gap: 0.5rem;
            height: 200px;
            margin-bottom: 0.5rem;
        }
        .chart-bar-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            height: 100%;
        }
        .chart-bar {
            width: 100%;
            background: linear-gradient(to top, #3b82f6, #60a5fa);
            border-radius: 0.25rem 0.25rem 0 0;
            min-height: 2px;
            transition: all 0.3s ease;
        }
        .chart-bar-container:hover .chart-bar {
            background: linear-gradient(to top, #2563eb, #3b82f6);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
        .chart-label {
            font-size: 0.625rem;
            color: #6b7280;
        }
        .chart-legend {
            text-align: center;
            font-size: 0.75rem;
            color: #9ca3af;
        }
        .loading {
            text-align: center;
            padding: 2rem;
            color: #9ca3af;
        }
        .error {
            text-align: center;
            padding: 2rem;
            color: #ef4444;
        }
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #9ca3af;
        }

        /* Analytics page styles */
        .progress-container {
            position: relative;
            width: 100%;
            height: 24px;
            background: #0f0f0f;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            transition: width 0.3s ease;
        }
        .progress-text {
            position: relative;
            display: block;
            line-height: 24px;
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            z-index: 1;
        }
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-success {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }
        .badge-warning {
            background: rgba(251, 146, 60, 0.2);
            color: #fb923c;
        }
        .priority-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .priority-high {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        .priority-medium {
            background: rgba(251, 146, 60, 0.2);
            color: #fb923c;
        }
        .priority-low {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }
        .gaps-header p {
            color: #9ca3af;
            margin-bottom: 1rem;
        }
        .gaps-footer {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #333;
        }
        .gaps-footer p {
            color: #9ca3af;
            font-size: 0.875rem;
        }
        .crud-table {
            width: 100%;
            border-collapse: collapse;
        }
        .crud-table thead {
            background: #0f0f0f;
        }
        .crud-table th {
            padding: 0.75rem 1rem;
            text-align: left;
            color: #9ca3af;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            border-bottom: 1px solid #333;
            white-space: nowrap;
        }
        .crud-table th > span {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        .crud-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #333;
            color: #d1d5db;
        }
        .crud-table tbody tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }
        .empty {
            text-align: center;
            padding: 2rem;
            color: #9ca3af;
        }
        .success {
            text-align: center;
            padding: 2rem;
            color: #4ade80;
            background: rgba(34, 197, 94, 0.1);
            border-radius: 0.5rem;
        }

        /* Tooltip styles */
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            color: #60a5fa;
            font-size: 10px;
            font-weight: bold;
            cursor: help;
            transition: all 0.2s ease;
            vertical-align: middle;
            margin-left: 6px;
            flex-shrink: 0;
        }
        .info-icon:hover, .info-icon:focus {
            background: rgba(59, 130, 246, 0.3);
            border-color: #60a5fa;
            transform: scale(1.1);
        }
        .info-icon:focus {
            outline: 2px solid #60a5fa;
            outline-offset: 2px;
        }
        .tooltip {
            position: fixed;
            max-width: 300px;
            padding: 12px 16px;
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 8px;
            color: #e5e7eb;
            font-size: 13px;
            line-height: 1.5;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.15s ease, visibility 0.15s ease;
            pointer-events: none;
        }
        .tooltip.visible {
            opacity: 1;
            visibility: visible;
        }
        .tooltip-arrow {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #1f2937;
            border: 1px solid #374151;
            transform: rotate(45deg);
        }
        .tooltip-arrow.top {
            bottom: -5px;
            left: 50%;
            margin-left: -4px;
            border-top: none;
            border-left: none;
        }
        .tooltip-arrow.bottom {
            top: -5px;
            left: 50%;
            margin-left: -4px;
            border-bottom: none;
            border-right: none;
        }
        .tooltip-arrow.left {
            right: -5px;
            top: 50%;
            margin-top: -4px;
            border-bottom: none;
            border-left: none;
        }
        .tooltip-arrow.right {
            left: -5px;
            top: 50%;
            margin-top: -4px;
            border-top: none;
            border-right: none;
        }

        /* ============================================
           NEW HEADER & STATUS BAR STYLES
           ============================================ */

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--color-card);
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1rem;
            z-index: 100;
        }

        .header-left,
        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-center {
            flex: 1;
            display: flex;
            justify-content: center;
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-title {
            font-weight: 700;
            font-size: 1.125rem;
            color: white;
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            gap: 1.5rem;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: var(--color-muted);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-muted);
            transition: background-color 0.3s ease;
        }

        .status-dot.healthy {
            background: var(--color-success);
            box-shadow: 0 0 8px var(--color-success);
        }

        .status-dot.warning {
            background: var(--color-warning);
            animation: pulse 2s infinite;
        }

        .status-dot.error {
            background: var(--color-error);
            animation: pulse 1s infinite;
        }

        .status-dot.unknown {
            background: var(--color-muted);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @media (prefers-reduced-motion: reduce) {
            .status-dot.warning,
            .status-dot.error {
                animation: none;
            }
        }

        /* Header Search */
        .header-search {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 0.5rem;
            color: var(--color-muted);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .header-search:hover {
            border-color: var(--color-border-hover);
            color: var(--color-text);
        }

        .header-search:focus-visible {
            outline: 2px solid var(--color-focus);
            outline-offset: 2px;
        }

        .header-search kbd {
            padding: 0.125rem 0.375rem;
            background: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: 0.25rem;
            font-size: 0.625rem;
            font-family: inherit;
        }

        /* Alerts Badge */
        .header-alerts {
            position: relative;
            padding: 0.5rem;
            background: transparent;
            border: none;
            color: var(--color-muted);
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }

        .header-alerts:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--color-text);
        }

        .header-alerts:focus-visible {
            outline: 2px solid var(--color-focus);
            outline-offset: 2px;
        }

        .alerts-badge {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 18px;
            height: 18px;
            padding: 0 4px;
            background: var(--color-error);
            color: white;
            font-size: 0.625rem;
            font-weight: 700;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .alerts-badge:empty,
        .alerts-badge[data-count="0"] {
            display: none;
        }

        /* ============================================
           ENHANCED BUTTON STYLES
           ============================================ */

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: var(--radius-md);
            border: none;
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .btn:focus-visible {
            outline: 2px solid var(--color-focus);
            outline-offset: 2px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow-btn-primary);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--color-primary-light) 0%, var(--color-primary) 100%);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.35);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--color-success) 0%, var(--color-success-dark) 100%);
            color: white;
            box-shadow: var(--shadow-btn-success);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, var(--color-success-light) 0%, var(--color-success) 100%);
            transform: translateY(-1px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--color-error) 0%, var(--color-error-dark) 100%);
            color: white;
            box-shadow: var(--shadow-btn-danger);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, var(--color-error-light) 0%, var(--color-error) 100%);
            transform: translateY(-1px);
        }

        .btn-ghost {
            background: transparent;
            color: var(--color-text-secondary);
            border: 1px solid var(--color-border);
        }

        .btn-ghost:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--color-border-hover);
            color: var(--color-text);
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }

        .btn-lg {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
        }

        @media (prefers-reduced-motion: reduce) {
            .btn {
                transition: background-color 0.15s ease, border-color 0.15s ease;
            }
            .btn:hover,
            .btn:active {
                transform: none;
            }
        }

        /* ============================================
           ENHANCED CARD STYLES
           ============================================ */

        .card {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--radius-lg);
            transition: all var(--transition-normal);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg), 0 0 30px rgba(59, 130, 246, 0.1);
            border-color: rgba(255, 255, 255, 0.12);
        }

        @supports not (backdrop-filter: blur(10px)) {
            .card {
                background: #1f1f1f;
                border-color: var(--color-border);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .card:hover {
                transform: none;
            }
        }

        /* ============================================
           SKELETON LOADING STYLES
           ============================================ */

        .skeleton {
            background: linear-gradient(90deg, #1a1a1a 25%, #242424 50%, #1a1a1a 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: var(--radius-sm);
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        @media (prefers-reduced-motion: reduce) {
            .skeleton {
                animation: none;
                opacity: 0.5;
            }
        }

        .skeleton-card {
            padding: 1rem;
        }

        /* ============================================
           COMMAND PALETTE STYLES
           ============================================ */

        #command-palette {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 200;
        }

        #command-palette.open {
            display: block;
        }

        .command-palette-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        .command-palette-dialog {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 600px;
            background: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
        }

        .command-palette-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            border-bottom: 1px solid var(--color-border);
        }

        .command-palette-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--color-text);
            font-size: 1rem;
            outline: none;
        }

        .command-palette-input::placeholder {
            color: var(--color-muted);
        }

        .command-palette-kbd {
            padding: 0.25rem 0.5rem;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 0.625rem;
            color: var(--color-muted);
        }

        .command-palette-results {
            max-height: 400px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .command-palette-category {
            padding: 0.5rem 0.75rem;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-muted);
        }

        .command-palette-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background-color var(--transition-fast);
        }

        .command-palette-item:hover,
        .command-palette-item.selected {
            background: var(--color-primary-bg);
        }

        .command-palette-item-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-muted);
        }

        .command-palette-item.selected .command-palette-item-icon {
            color: var(--color-primary-light);
        }

        .command-palette-item-content {
            flex: 1;
        }

        .command-palette-item-label {
            font-weight: 500;
            color: var(--color-text);
        }

        .command-palette-item-description {
            font-size: 0.75rem;
            color: var(--color-muted);
        }

        .command-palette-empty {
            padding: 2rem;
            text-align: center;
            color: var(--color-muted);
        }

        .command-palette-footer {
            padding: 0.75rem 1rem;
            border-top: 1px solid var(--color-border);
            background: var(--color-bg);
        }

        .command-palette-hint {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: var(--color-muted);
        }

        .command-palette-hint kbd {
            padding: 0.125rem 0.375rem;
            background: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 0.625rem;
            margin-right: 0.25rem;
        }

        /* ============================================
           ACCESSIBILITY
           ============================================ */

        /* Focus visible for keyboard navigation */
        :focus-visible {
            outline: 2px solid var(--color-focus);
            outline-offset: 2px;
        }

        /* Remove outline for mouse users */
        :focus:not(:focus-visible) {
            outline: none;
        }

        /* Skip to content link */
        .skip-link {
            position: absolute;
            top: -100px;
            left: 0;
            background: var(--color-primary);
            color: white;
            padding: 0.5rem 1rem;
            z-index: 1000;
            transition: top 0.2s ease;
        }

        .skip-link:focus {
            top: 0;
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .status-dot {
                border: 2px solid currentColor;
            }
        }

        /* Metric values with mono font */
        .metric-value,
        .stat-value-mono,
        code,
        pre {
            font-family: var(--font-mono);
        }

        /* =============================================
           TABLET RESPONSIVE STYLES (< 1024px)
           ============================================= */
        @media (max-width: 1024px) {
            /* Sidebar becomes icon bar */
            .sidebar {
                width: 56px !important;
                position: fixed;
                z-index: 30;
                top: 60px;
                bottom: 0;
                overflow: hidden;
                transition: width 0.3s ease;
            }

            .sidebar.mobile-expanded {
                width: 240px !important;
            }

            /* Hide sidebar item text by default */
            .sidebar .sidebar-item span:not(.sidebar-icon):not(.sidebar-category-title):not(.sidebar-category-chevron) {
                display: none;
            }

            .sidebar.mobile-expanded .sidebar-item span {
                display: inline;
            }

            /* Hide category titles in collapsed mode */
            .sidebar .sidebar-category-title {
                display: none;
            }

            .sidebar.mobile-expanded .sidebar-category-title {
                display: inline;
            }

            /* Main content shifts left */
            .main-content {
                margin-left: 56px;
            }

            /* Sidebar toggle button */
            .sidebar-toggle {
                display: block;
            }
        }

        /* =============================================
           MOBILE RESPONSIVE STYLES (< 768px)
           ============================================= */
        @media (max-width: 768px) {
            /* Grid layouts become single column */
            .grid-cols-2,
            .md\\:grid-cols-2,
            .lg\\:grid-cols-2,
            .xl\\:grid-cols-4 {
                grid-template-columns: 1fr !important;
            }

            /* Tables become cards */
            .data-table-responsive thead {
                display: none;
            }

            .data-table-responsive tr {
                display: block;
                margin-bottom: 1rem;
                background: var(--color-card);
                border: 1px solid var(--color-border);
                border-radius: 8px;
                padding: 1rem;
            }

            .data-table-responsive td {
                display: flex;
                justify-content: space-between;
                padding: 0.5rem 0;
                border: none;
            }

            .data-table-responsive td::before {
                content: attr(data-label);
                font-weight: 500;
                color: var(--color-muted);
            }

            /* Hide sidebar completely on mobile */
            .sidebar {
                display: none;
            }

            .sidebar.mobile-visible {
                display: flex;
                width: 100% !important;
                position: fixed;
                top: 60px;
                left: 0;
                right: 0;
                bottom: 0;
            }

            .main-content {
                margin-left: 0;
            }
        }

        /* =============================================
           FOCUS RING SYSTEM - ACCESSIBILITY
           ============================================= */
        .focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--color-bg), 0 0 0 4px var(--color-border-focus);
        }

        .focus-ring:focus-visible {
            outline: none;
            box-shadow: 0 0 0 2px var(--color-bg), 0 0 0 4px var(--color-border-focus);
        }

        /* Apply to all interactive elements */
        button:focus-visible,
        a:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible,
        [tabindex]:focus-visible {
            outline: none;
            box-shadow: 0 0 0 2px var(--color-bg), 0 0 0 4px var(--color-border-focus);
        }

        /* =============================================
           VOICE CONFIG - MODEL/VOICE OPTIONS
           ============================================= */
        .model-list, .voice-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .model-option {
            background: var(--color-bg-secondary, #1f2937);
            border: 1px solid var(--color-border, #374151);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .model-option:hover {
            border-color: var(--color-primary, #3b82f6);
            background: rgba(59, 130, 246, 0.1);
        }
        .model-option.active {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }
        .model-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
        }
        .model-name {
            font-weight: 500;
            color: #e5e7eb;
        }
        .model-size {
            font-size: 0.75rem;
            color: #9ca3af;
            background: rgba(156, 163, 175, 0.2);
            padding: 2px 8px;
            border-radius: 4px;
        }
        .model-quality {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 4px;
            text-transform: uppercase;
        }
        .model-description {
            font-size: 0.8rem;
            color: #9ca3af;
            margin: 0;
        }
        .active-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 0.7rem;
            color: #22c55e;
            background: rgba(34, 197, 94, 0.2);
            padding: 2px 8px;
            border-radius: 4px;
        }

        /* =============================================
           VOICE CONFIG - SYNC STATUS
           ============================================= */
        .sync-ok {
            color: #22c55e;
            font-size: 0.85rem;
        }
        .sync-mismatch {
            color: #f59e0b;
            font-size: 0.85rem;
        }
        .sync-unknown {
            color: #6b7280;
            font-size: 0.85rem;
        }
        .section-note {
            font-size: 0.8rem;
            color: #9ca3af;
            margin: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .quality-legend {
            gap: 1rem !important;
            flex-wrap: wrap;
        }
        .quality-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .quality-badge.quality-low {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        .quality-badge.quality-medium {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }
        .quality-badge.quality-high {
            background: rgba(168, 85, 247, 0.2);
            color: #a855f7;
        }
        .voice-region-header {
            margin: 1rem 0 0.5rem 0;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--color-border);
            color: #e5e7eb;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .model-quality.quality-low { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .model-quality.quality-medium { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .model-quality.quality-high { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
    </style>
</head>
<body class="bg-dark-bg text-gray-200">
    <!-- Header -->
    <header class="bg-dark-card border-b border-dark-border h-[60px] flex items-center justify-between px-6 fixed top-0 left-0 right-0 z-50" role="banner" aria-label="Status bar">
        <div class="flex items-center gap-3">
            <div class="flex items-center gap-2">
                <i data-lucide="sparkles" class="w-6 h-6 text-blue-400"></i>
                <h1 class="text-xl font-bold text-white">Project Athena</h1>
            </div>
            <span class="text-xs text-gray-500">|</span>
            <p class="text-xs text-gray-400">Admin Dashboard</p>

            <!-- Status Bar -->
            <span class="text-xs text-gray-500 ml-4">|</span>
            <div class="status-bar ml-2">
                <div class="status-item" id="status-gateway" title="Gateway">
                    <span class="status-dot unknown"></span>
                    <span class="hidden md:inline">Gateway</span>
                </div>
                <div class="status-item" id="status-orchestrator" title="Orchestrator">
                    <span class="status-dot unknown"></span>
                    <span class="hidden md:inline">Orchestrator</span>
                </div>
                <div class="status-item" id="status-ollama" title="Ollama">
                    <span class="status-dot unknown"></span>
                    <span class="hidden md:inline">Ollama</span>
                </div>
                <div class="status-item" id="status-redis" title="Redis">
                    <span class="status-dot unknown"></span>
                    <span class="hidden md:inline">Redis</span>
                </div>
                <div class="status-item" id="status-qdrant" title="Qdrant">
                    <span class="status-dot unknown"></span>
                    <span class="hidden md:inline">Qdrant</span>
                </div>
                <div class="status-item" id="status-mlx" title="MLX">
                    <span class="status-dot unknown"></span>
                    <span class="hidden md:inline">MLX</span>
                </div>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <!-- Command Palette Trigger -->
            <button onclick="CommandPalette.open()" class="header-search hidden md:flex" title="Search commands (Cmd+K)">
                <i data-lucide="search" class="w-4 h-4"></i>
                <span>Search...</span>
                <kbd>⌘K</kbd>
            </button>

            <!-- Alerts Bell -->
            <div class="relative" id="alerts-container">
                <button onclick="toggleAlertsDropdown()" id="alerts-bell"
                    class="relative p-2 text-gray-400 hover:text-white transition-colors rounded-lg hover:bg-gray-700/50">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                    </svg>
                    <span id="alerts-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </button>
                <!-- Alerts Dropdown -->
                <div id="alerts-dropdown" class="hidden absolute right-0 mt-2 w-96 bg-dark-card border border-dark-border rounded-lg shadow-xl z-50">
                    <div class="p-3 border-b border-dark-border flex items-center justify-between">
                        <h3 class="text-sm font-semibold text-white">System Alerts</h3>
                        <button onclick="showTab('alerts'); toggleAlertsDropdown();" class="text-xs text-blue-400 hover:text-blue-300">View All</button>
                    </div>
                    <div id="alerts-list" class="max-h-80 overflow-y-auto">
                        <div class="p-4 text-center text-gray-500 text-sm">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Auth Section -->
            <div id="auth-section">
                <button onclick="handleAuth()" id="auth-button"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                    Login
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container (Sidebar + Content) -->
    <div class="flex" style="margin-top: 60px;">
        <!-- Left Sidebar -->
        <aside class="sidebar bg-dark-sidebar border-r border-dark-border flex-shrink-0" role="navigation" aria-label="Main navigation">
            <nav class="py-2">
                <!-- Mission Control (default landing page) -->
                <button onclick="showTab('mission-control')" data-route="mission-control" class="sidebar-item sidebar-item-active w-full text-left px-4 py-3 text-sm font-medium flex items-center gap-3 transition-all">
                    <i data-lucide="gauge" class="sidebar-icon"></i>
                    <span>Mission Control</span>
                </button>

                <!-- Dashboard -->
                <button onclick="showTab('dashboard')" data-route="dashboard" class="sidebar-item w-full text-left px-4 py-3 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                    <i data-lucide="layout-dashboard" class="sidebar-icon"></i>
                    <span>Dashboard</span>
                </button>

                <!-- Activity Toggle Button -->
                <button onclick="Athena.components.Activity?.toggle()" class="sidebar-item w-full text-left px-4 py-3 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all" title="Toggle Activity Sidebar">
                    <i data-lucide="activity" class="sidebar-icon"></i>
                    <span>Activity</span>
                </button>

                <!-- Voice Pipelines -->
                <button onclick="showTab('voice-pipelines')" data-route="voice-pipelines" class="sidebar-item w-full text-left px-4 py-3 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                    <i data-lucide="audio-waveform" class="sidebar-icon"></i>
                    <span>Voice Pipelines</span>
                </button>

                <!-- Memory & Context -->
                <button onclick="showTab('memory-context')" data-route="memory-context" class="sidebar-item w-full text-left px-4 py-3 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                    <i data-lucide="brain" class="sidebar-icon"></i>
                    <span>Memory & Context</span>
                </button>

                <!-- Integrations -->
                <button onclick="showTab('integrations')" data-route="integrations" class="sidebar-item w-full text-left px-4 py-3 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                    <i data-lucide="plug" class="sidebar-icon"></i>
                    <span>Integrations</span>
                </button>

                <!-- Configuration Category -->
                <div class="sidebar-category" id="cat-config">
                    <div class="sidebar-category-header" onclick="toggleCategory('config')">
                        <span class="sidebar-category-title">Configuration</span>
                        <span class="sidebar-category-chevron">▼</span>
                    </div>
                    <div class="sidebar-category-items">
                        <button onclick="showTab('policies')" data-route="policies" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="file-text" class="sidebar-icon"></i>
                            <span>Policies</span>
                        </button>
                        <button onclick="showTab('secrets')" data-route="secrets" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="lock" class="sidebar-icon"></i>
                            <span>Secrets</span>
                        </button>
                        <button onclick="showTab('external-api-keys')" data-route="external-api-keys" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="key" class="sidebar-icon"></i>
                            <span>External API Keys</span>
                        </button>
                        <button onclick="showTab('user-api-keys')" data-route="user-api-keys" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="key-round" class="sidebar-icon"></i>
                            <span>User API Keys</span>
                        </button>
                        <button onclick="showTab('base-knowledge')" data-route="base-knowledge" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="book-open" class="sidebar-icon"></i>
                            <span>Base Knowledge</span>
                        </button>
                        <button onclick="showTab('features')" data-route="features" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="toggle-right" class="sidebar-icon"></i>
                            <span>Feature Flags</span>
                        </button>
                        <button onclick="showTab('system-config')" data-route="system-config" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="settings" class="sidebar-icon"></i>
                            <span>System Config</span>
                        </button>
                        <button onclick="showTab('presets')" data-route="presets" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="zap" class="sidebar-icon"></i>
                            <span>Presets</span>
                        </button>
                    </div>
                </div>

                <!-- AI & LLM Category -->
                <div class="sidebar-category" id="cat-ai">
                    <div class="sidebar-category-header" onclick="toggleCategory('ai')">
                        <span class="sidebar-category-title">AI & LLM</span>
                        <span class="sidebar-category-chevron">▼</span>
                    </div>
                    <div class="sidebar-category-items">
                        <button onclick="showTab('llm-backends')" data-route="llm-backends" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="cpu" class="sidebar-icon"></i>
                            <span>LLM Backends</span>
                        </button>
                        <button onclick="showTab('model-config')" data-route="model-config" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="sliders-horizontal" class="sidebar-icon"></i>
                            <span>Model Configuration</span>
                        </button>
                        <button onclick="showTab('model-downloads')" data-route="model-downloads" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="download" class="sidebar-icon"></i>
                            <span>Model Downloads</span>
                        </button>
                        <button onclick="showTab('cloud-providers')" data-route="cloud-providers" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="cloud" class="sidebar-icon"></i>
                            <span>Cloud Providers</span>
                        </button>
                        <button onclick="showTab('service-bypass')" data-route="service-bypass" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="shuffle" class="sidebar-icon"></i>
                            <span>Service Bypass</span>
                        </button>
                        <button onclick="showTab('llm-components')" data-route="llm-components" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="brain" class="sidebar-icon"></i>
                            <span>LLM Components</span>
                        </button>
                        <button onclick="showTab('conversation-context')" data-route="conversation-context" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="message-square" class="sidebar-icon"></i>
                            <span>Conversation Context</span>
                        </button>
                        <button onclick="showTab('intent-routing')" data-route="intent-routing" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="compass" class="sidebar-icon"></i>
                            <span>Intent Routing</span>
                        </button>
                        <button onclick="showTab('hallucination-checks')" data-route="hallucination-checks" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="shield-check" class="sidebar-icon"></i>
                            <span>Hallucination Checks</span>
                        </button>
                        <button onclick="showTab('multi-intent')" data-route="multi-intent" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="git-branch" class="sidebar-icon"></i>
                            <span>Multi-Intent Config</span>
                        </button>
                        <button onclick="showTab('validation-models')" data-route="validation-models" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="bot" class="sidebar-icon"></i>
                            <span>Validation Models</span>
                        </button>
                        <button onclick="showTab('memory-management')" data-route="memory-management" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="database" class="sidebar-icon"></i>
                            <span>Memory Management</span>
                        </button>
                        <button onclick="showTab('emerging-intents')" data-route="emerging-intents" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="search" class="sidebar-icon"></i>
                            <span>Emerging Intents</span>
                        </button>
                    </div>
                </div>

                <!-- Tool Calling Category -->
                <div class="sidebar-category" id="cat-tools">
                    <div class="sidebar-category-header" onclick="toggleCategory('tools')">
                        <span class="sidebar-category-title">Tool Calling</span>
                        <span class="sidebar-category-chevron">▼</span>
                    </div>
                    <div class="sidebar-category-items">
                        <button onclick="showTab('tool-calling-settings')" data-route="tool-calling-settings" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="settings" class="sidebar-icon"></i>
                            <span>Settings</span>
                        </button>
                        <button onclick="showTab('tool-registry')" data-route="tool-registry" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="wrench" class="sidebar-icon"></i>
                            <span>Tool Registry</span>
                        </button>
                        <button onclick="showTab('trigger-config')" data-route="trigger-config" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="crosshair" class="sidebar-icon"></i>
                            <span>Trigger Config</span>
                        </button>
                        <button onclick="showTab('tool-testing')" data-route="tool-testing" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="flask-conical" class="sidebar-icon"></i>
                            <span>Tool Testing</span>
                        </button>
                        <button onclick="showTab('escalation')" data-route="escalation" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="trending-up" class="sidebar-icon"></i>
                            <span>Model Escalation</span>
                        </button>
                        <button onclick="showTab('debug-logs')" data-route="debug-logs" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="file-search" class="sidebar-icon"></i>
                            <span>Debug Logs</span>
                        </button>
                    </div>
                </div>

                <!-- Smart Home Category -->
                <div class="sidebar-category" id="cat-smarthome">
                    <div class="sidebar-category-header" onclick="toggleCategory('smarthome')">
                        <span class="sidebar-category-title">Smart Home</span>
                        <span class="sidebar-category-chevron">▼</span>
                    </div>
                    <div class="sidebar-category-items">
                        <button onclick="showTab('room-groups')" data-route="room-groups" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="home" class="sidebar-icon"></i>
                            <span>Room Groups</span>
                        </button>
                        <button onclick="showTab('devices')" data-route="devices" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="smartphone" class="sidebar-icon"></i>
                            <span>Devices</span>
                        </button>
                        <button onclick="showTab('rag-connectors')" data-route="rag-connectors" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="link" class="sidebar-icon"></i>
                            <span>RAG Connectors</span>
                        </button>
                        <button onclick="showTab('site-scraper')" data-route="site-scraper" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="globe" class="sidebar-icon"></i>
                            <span>Site Scraper</span>
                        </button>
                        <button onclick="showTab('directions-settings')" data-route="directions-settings" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="map-pin" class="sidebar-icon"></i>
                            <span>Directions</span>
                        </button>
                        <button onclick="showTab('music-config')" data-route="music-config" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="music" class="sidebar-icon"></i>
                            <span>Music Config</span>
                        </button>
                        <button onclick="showTab('room-audio')" data-route="room-audio" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="volume-2" class="sidebar-icon"></i>
                            <span>Room Audio</span>
                        </button>
                        <button onclick="showTab('room-tv')" data-route="room-tv" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="tv" class="sidebar-icon"></i>
                            <span>Room TV</span>
                        </button>
                        <button onclick="showTab('follow-me')" data-route="follow-me" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="footprints" class="sidebar-icon"></i>
                            <span>Follow-Me Audio</span>
                        </button>
                    </div>
                </div>

                <!-- Guest Experience Category -->
                <div class="sidebar-category" id="cat-guest">
                    <div class="sidebar-category-header" onclick="toggleCategory('guest')">
                        <span class="sidebar-category-title">Guest Experience</span>
                        <span class="sidebar-category-chevron">▼</span>
                    </div>
                    <div class="sidebar-category-items">
                        <button onclick="showTab('guest-mode')" data-route="guest-mode" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="user-check" class="sidebar-icon"></i>
                            <span>Guest Mode</span>
                        </button>
                        <button onclick="showTab('voice-automations')" data-route="voice-automations" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="mic" class="sidebar-icon"></i>
                            <span>Voice Automations</span>
                        </button>
                        <button onclick="showTab('sms')" data-route="sms" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="message-circle" class="sidebar-icon"></i>
                            <span>SMS & Communications</span>
                        </button>
                        <button onclick="showTab('calendar-sources')" data-route="calendar-sources" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="calendar" class="sidebar-icon"></i>
                            <span>Calendar Sources</span>
                        </button>
                    </div>
                </div>

                <!-- Analytics & Metrics Category -->
                <div class="sidebar-category" id="cat-analytics">
                    <div class="sidebar-category-header" onclick="toggleCategory('analytics')">
                        <span class="sidebar-category-title">Analytics & Metrics</span>
                        <span class="sidebar-category-chevron">▼</span>
                    </div>
                    <div class="sidebar-category-items">
                        <button onclick="showTab('intent-analytics')" data-route="intent-analytics" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="target" class="sidebar-icon"></i>
                            <span>Intent Analytics</span>
                        </button>
                        <button onclick="showTab('performance-metrics')" data-route="performance-metrics" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="trending-up" class="sidebar-icon"></i>
                            <span>Performance Metrics</span>
                        </button>
                        <button onclick="showTab('tool-metrics')" data-route="tool-metrics" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="bar-chart-3" class="sidebar-icon"></i>
                            <span>Tool Metrics</span>
                        </button>
                    </div>
                </div>

                <!-- Infrastructure Category -->
                <div class="sidebar-category" id="cat-infra">
                    <div class="sidebar-category-header" onclick="toggleCategory('infra')">
                        <span class="sidebar-category-title">Infrastructure</span>
                        <span class="sidebar-category-chevron">▼</span>
                    </div>
                    <div class="sidebar-category-items">
                        <button onclick="showTab('service-control')" data-route="service-control" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="server" class="sidebar-icon"></i>
                            <span>Service Control</span>
                        </button>
                        <button onclick="showTab('gateway-settings')" data-route="gateway-settings" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="network" class="sidebar-icon"></i>
                            <span>Gateway Settings</span>
                        </button>
                        <button onclick="showTab('voice-config')" data-route="voice-config" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="mic-2" class="sidebar-icon"></i>
                            <span>Voice Config</span>
                        </button>
                        <a href="/searxng" target="_blank" rel="noopener noreferrer" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all hover:bg-[rgba(255,255,255,0.05)]">
                            <i data-lucide="search" class="sidebar-icon"></i>
                            <span>SearXNG</span>
                            <i data-lucide="external-link" class="w-3 h-3 text-gray-500"></i>
                        </a>
                    </div>
                </div>

                <!-- System Category -->
                <div class="sidebar-category" id="cat-system">
                    <div class="sidebar-category-header" onclick="toggleCategory('system')">
                        <span class="sidebar-category-title">System</span>
                        <span class="sidebar-category-chevron">▼</span>
                    </div>
                    <div class="sidebar-category-items">
                        <button onclick="showTab('alerts')" data-route="alerts" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="bell" class="sidebar-icon"></i>
                            <span>Alerts</span>
                            <span id="sidebar-alerts-badge" class="hidden ml-auto bg-red-500 text-white text-xs font-bold rounded-full px-2 py-0.5">0</span>
                        </button>
                        <button onclick="showTab('users')" data-route="users" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="users" class="sidebar-icon"></i>
                            <span>Users</span>
                        </button>
                        <button onclick="showTab('audit')" data-route="audit" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="scroll-text" class="sidebar-icon"></i>
                            <span>Audit Logs</span>
                        </button>
                        <button onclick="showTab('settings')" data-route="settings" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="settings-2" class="sidebar-icon"></i>
                            <span>Settings</span>
                        </button>
                        <button onclick="showTab('voice-testing')" data-route="voice-testing" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="mic" class="sidebar-icon"></i>
                            <span>Voice Testing</span>
                        </button>
                        <button onclick="showTab('admin-jarvis')" data-route="admin-jarvis" class="sidebar-item w-full text-left px-4 py-2 text-sm font-medium text-gray-400 flex items-center gap-3 transition-all">
                            <i data-lucide="bot" class="sidebar-icon"></i>
                            <span>Admin Jarvis</span>
                        </button>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content flex-1 bg-dark-bg px-8 py-6" role="main" aria-label="Main content">
            <!-- Mission Control Tab (Default Landing Page) -->
            <div id="tab-mission-control" class="tab-content">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h1 class="text-2xl font-bold text-white">Mission Control</h1>
                        <p class="text-gray-400 text-sm mt-1">System overview at a glance</p>
                    </div>
                </div>
                <div id="mission-control-content">
                    <!-- Populated by mission-control.js -->
                    <div class="text-center py-8 text-gray-400">Loading Mission Control...</div>
                </div>
            </div>

            <!-- Voice Pipelines Tab -->
            <div id="tab-voice-pipelines" class="tab-content hidden">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h1 class="text-2xl font-bold text-white">Voice Pipelines</h1>
                        <p class="text-gray-400 text-sm mt-1">Configure and monitor voice processing components</p>
                    </div>
                </div>
                <div id="voice-pipelines-content">
                    <div class="text-center py-8 text-gray-400">Loading Voice Pipelines...</div>
                </div>
            </div>

            <!-- Memory & Context Tab -->
            <div id="tab-memory-context" class="tab-content hidden">
                <div class="mb-6">
                    <h1 class="text-2xl font-bold text-white">Memory & Context</h1>
                    <p class="text-gray-400 text-sm mt-1">Manage household context, guest profiles, and base knowledge</p>
                </div>
                <div id="memory-context-content">
                    <div class="text-center py-8 text-gray-400">Loading Memory & Context...</div>
                </div>
            </div>

            <!-- Integrations Tab -->
            <div id="tab-integrations" class="tab-content hidden">
                <div class="mb-6">
                    <h1 class="text-2xl font-bold text-white">Integrations</h1>
                    <p class="text-gray-400 text-sm mt-1">Connect and manage external service providers</p>
                </div>
                <div id="integrations-content">
                    <div class="text-center py-8 text-gray-400">Loading Integrations...</div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Service Status</h2>
                    <button onclick="loadStatus()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6" id="stats-container" style="display:none;">
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <div class="text-3xl font-bold text-green-400" id="stat-healthy">-</div>
                        <div class="text-sm text-gray-400 mt-1 flex items-center">Healthy Services<span class="info-icon" tabindex="0" role="button" aria-label="More information" data-tooltip="Number of services currently responding to health checks successfully." onmouseenter="showTooltip(event)" onmouseleave="hideTooltip()" onfocus="showTooltip(event)" onblur="hideTooltip()" onclick="toggleTooltip(event)">i</span></div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <div class="text-3xl font-bold text-blue-400" id="stat-total">-</div>
                        <div class="text-sm text-gray-400 mt-1 flex items-center">Total Services<span class="info-icon" tabindex="0" role="button" aria-label="More information" data-tooltip="Total number of services registered in the system." onmouseenter="showTooltip(event)" onmouseleave="hideTooltip()" onfocus="showTooltip(event)" onblur="hideTooltip()" onclick="toggleTooltip(event)">i</span></div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <div class="text-3xl font-bold" id="stat-health">-</div>
                        <div class="text-sm text-gray-400 mt-1 flex items-center">Overall Health<span class="info-icon" tabindex="0" role="button" aria-label="More information" data-tooltip="Overall system health status based on the health of all registered services. Green = all healthy, Yellow = some degraded, Red = critical failures." onmouseenter="showTooltip(event)" onmouseleave="hideTooltip()" onfocus="showTooltip(event)" onblur="hideTooltip()" onclick="toggleTooltip(event)">i</span></div>
                    </div>
                </div>

                <!-- Error Container -->
                <div id="error-container"></div>

                <!-- Services by Group -->
                <div id="services-by-group-container"></div>
            </div>

            <!-- Policies Tab -->
            <div id="tab-policies" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Policy Management</h2>
                    <button onclick="showCreatePolicyModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                        ➕ Create Policy
                    </button>
                </div>
                <div id="policies-container" class="space-y-4"></div>
            </div>

            <!-- Secrets Tab -->
            <div id="tab-secrets" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Secret Management</h2>
                    <button onclick="showCreateSecretModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                        ➕ Create Secret
                    </button>
                </div>
                <div class="bg-yellow-900/20 border border-yellow-700/50 rounded-lg p-4 mb-4">
                    <p class="text-yellow-200 text-sm">⚠️ Revealing secrets will be logged in audit trail</p>
                </div>
                <div id="secrets-container" class="space-y-4"></div>
            </div>

            <!-- External API Keys Tab -->
            <div id="tab-external-api-keys" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">External API Keys</h2>
                    <button onclick="showCreateExternalApiKeyModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                        ➕ Add API Key
                    </button>
                </div>
                <div class="bg-blue-900/20 border border-blue-700/50 rounded-lg p-4 mb-4">
                    <p class="text-blue-200 text-sm">Keys are stored encrypted; values are masked in the UI.</p>
                </div>
                <div id="external-api-keys-container" class="space-y-4"></div>
            </div>

            <!-- User API Keys Tab -->
            <div id="tab-user-api-keys" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">User API Keys</h2>
                    <div class="flex gap-2">
                        <button onclick="loadUserApiKeys()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                        </button>
                        <button onclick="showCreateUserApiKeyModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ➕ Create API Key
                        </button>
                    </div>
                </div>
                <div class="bg-blue-900/20 border border-blue-700/50 rounded-lg p-4 mb-4">
                    <p class="text-blue-200 text-sm">
                        Create API keys for programmatic access to the admin API.
                        Use these keys in the <code class="bg-dark-bg px-1 rounded">X-API-Key</code> header instead of browser login for scripts, automation, and testing.
                    </p>
                </div>
                <div id="user-api-keys-container" class="space-y-4"></div>
            </div>

            <!-- Devices Tab -->
            <div id="tab-devices" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Device Registry</h2>
                    <button onclick="showCreateDeviceModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                        ➕ Register Device
                    </button>
                </div>
                <div id="devices-container" class="space-y-4"></div>
            </div>

            <!-- Room Groups Tab -->
            <div id="tab-room-groups" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Room Groups & Aliases</h2>
                    <div class="flex gap-2">
                        <button onclick="loadRoomGroups()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                        </button>
                        <button onclick="showCreateRoomGroupModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ➕ Create Group
                        </button>
                    </div>
                </div>

                <!-- Info Banner -->
                <div class="bg-blue-900/30 border border-blue-700 rounded-lg p-4 mb-6">
                    <div class="flex items-start gap-3">
                        <span class="text-xl">💡</span>
                        <div>
                            <p class="text-blue-200 font-medium">Room Groups enable natural language commands like:</p>
                            <p class="text-gray-400 text-sm mt-1">"Turn on the first floor lights" or "Set downstairs to blue"</p>
                            <p class="text-gray-400 text-sm mt-1">Create groups, add aliases (alternate names), and assign rooms to each group.</p>
                        </div>
                    </div>
                </div>

                <!-- Room Groups Container -->
                <div id="room-groups-container" class="space-y-4"></div>
            </div>

            <!-- Users Tab -->
            <div id="tab-users" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">User Management</h2>
                    <button onclick="loadUsers()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>
                <div id="users-container" class="space-y-4"></div>
            </div>

            <!-- Alerts Tab -->
            <div id="tab-alerts" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">System Alerts</h2>
                    <div class="flex gap-2">
                        <select id="alerts-status-filter" onchange="loadAlertsPage()" class="px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-sm text-gray-300">
                            <option value="">All Statuses</option>
                            <option value="active" selected>Active</option>
                            <option value="acknowledged">Acknowledged</option>
                            <option value="resolved">Resolved</option>
                        </select>
                        <select id="alerts-type-filter" onchange="loadAlertsPage()" class="px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-sm text-gray-300">
                            <option value="">All Types</option>
                            <option value="stuck_sensor">Stuck Sensors</option>
                            <option value="service_down">Service Down</option>
                            <option value="system_warning">System Warning</option>
                        </select>
                        <button onclick="acknowledgeAllAlerts()" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ✓ Acknowledge All
                        </button>
                        <button onclick="loadAlertsPage()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Alert Stats -->
                <div id="alerts-stats" class="grid grid-cols-4 gap-4 mb-6">
                    <div class="bg-dark-card border border-dark-border rounded-lg p-4">
                        <div class="text-2xl font-bold text-red-400" id="stat-active">0</div>
                        <div class="text-sm text-gray-400">Active</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-4">
                        <div class="text-2xl font-bold text-yellow-400" id="stat-acknowledged">0</div>
                        <div class="text-sm text-gray-400">Acknowledged</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-4">
                        <div class="text-2xl font-bold text-green-400" id="stat-resolved">0</div>
                        <div class="text-sm text-gray-400">Resolved</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-4">
                        <div class="text-2xl font-bold text-gray-400" id="stat-total">0</div>
                        <div class="text-sm text-gray-400">Total</div>
                    </div>
                </div>

                <!-- Alerts List -->
                <div id="alerts-page-container" class="space-y-3"></div>
            </div>

            <!-- Audit Tab -->
            <div id="tab-audit" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Audit Logs</h2>
                    <button onclick="loadAuditLogs()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>
                <div id="audit-container" class="space-y-4"></div>
            </div>

            <!-- Settings Tab -->
            <div id="tab-settings" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Settings</h2>
                    <button onclick="loadSettings()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>

                <!-- OIDC Configuration Section -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">OIDC Authentication Settings</h3>
                        <button onclick="loadOIDCSettings()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                        </button>
                    </div>
                    <div id="oidc-container" class="bg-dark-card rounded-lg p-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">OIDC Provider URL</label>
                                <input type="text" id="oidc-provider-url" placeholder="https://your-auth-server.com/application/o/athena-admin/"
                                    class="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Client ID</label>
                                <input type="text" id="oidc-client-id" placeholder="Enter Client ID"
                                    class="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Client Secret</label>
                                <input type="password" id="oidc-client-secret" placeholder="Enter Client Secret"
                                    class="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Redirect URI</label>
                                <input type="text" id="oidc-redirect-uri" value="http://localhost:8080/api/auth/callback" readonly
                                    class="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-400 cursor-not-allowed">
                            </div>
                        </div>
                        <div class="mt-6 flex items-center justify-between">
                            <div id="oidc-status" class="text-sm"></div>
                            <div class="flex gap-3">
                                <button onclick="testOIDCConnection()" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-sm font-medium transition-colors">
                                    🔍 Test Connection
                                </button>
                                <button onclick="saveOIDCSettings()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                                    💾 Save Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Server Configuration Section -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Server Configuration</h3>
                        <button onclick="showCreateServerModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ➕ Add Server
                        </button>
                    </div>
                    <div id="servers-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>

                <!-- Service Registry Section -->
                <div>
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Service Registry</h3>
                        <button onclick="refreshAllServices()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Check All Services
                        </button>
                    </div>
                    <div id="services-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
            </div>

            <!-- RAG Connectors Tab -->
            <div id="tab-rag-connectors" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">RAG Connectors</h2>
                    <button onclick="showCreateConnectorModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                        ➕ Add Connector
                    </button>
                </div>
                <div id="connectors-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>

            <!-- Site Scraper Tab -->
            <div id="tab-site-scraper" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-semibold text-white">Site Scraper Configuration</h2>
                    <p class="text-gray-400 mt-1">Configure URL access restrictions and domain whitelists for the site scraper service</p>
                </div>
                <div id="site-scraper-config">
                    <div class="text-center text-gray-400 py-12">
                        <div class="text-4xl mb-4 animate-pulse">&#9201;</div>
                        <p>Loading site scraper configuration...</p>
                    </div>
                </div>
            </div>

            <!-- Directions Settings Tab -->
            <div id="tab-directions-settings" class="tab-content hidden">
                <div id="directions-settings-container">
                    <div class="text-center text-gray-400 py-12">
                        <div class="text-4xl mb-4 animate-pulse">&#9201;</div>
                        <p>Loading directions settings...</p>
                    </div>
                </div>
                <!-- Origin Placeholder Patterns (System Setting) -->
                <div id="origin-placeholder-container">
                    <div class="text-center text-gray-400 py-8">
                        <p>Loading origin placeholder settings...</p>
                    </div>
                </div>
            </div>

            <!-- Music Configuration Tab -->
            <div id="tab-music-config" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Music Configuration</h2>
                </div>
                <div id="music-config-container">
                    <div class="text-center text-gray-400 py-12">
                        <div class="text-4xl mb-4 animate-pulse">🎵</div>
                        <p>Loading music configuration...</p>
                    </div>
                </div>
            </div>

            <!-- Room Audio Configuration Tab -->
            <div id="tab-room-audio" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Room Audio Configuration</h2>
                    <button onclick="showCreateRoomModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                        + Add Room
                    </button>
                </div>
                <div id="room-audio-container">
                    <div class="text-center text-gray-400 py-12">
                        <div class="text-4xl mb-4 animate-pulse">🔊</div>
                        <p>Loading room audio configurations...</p>
                    </div>
                </div>
            </div>

            <!-- Room TV Configuration Tab -->
            <div id="tab-room-tv" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Room TV Configuration</h2>
                    <div class="flex gap-2">
                        <button onclick="discoverAppleTVs()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            Discover Apple TVs
                        </button>
                    </div>
                </div>
                <div id="room-tv-container">
                    <div class="text-center text-gray-400 py-12">
                        <div class="text-4xl mb-4 animate-pulse">📺</div>
                        <p>Loading TV configurations...</p>
                    </div>
                </div>
            </div>

            <!-- Follow-Me Audio Tab -->
            <div id="tab-follow-me" class="tab-content hidden">
                <div id="follow-me-container">
                    <div class="text-center text-gray-400 py-12">
                        <div class="text-4xl mb-4 animate-pulse">🚶</div>
                        <p>Loading follow-me configuration...</p>
                    </div>
                </div>
            </div>

            <!-- Voice Config Tab -->
            <div id="tab-voice-config" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Voice Configuration</h2>
                    <p class="text-gray-400 text-sm">Configure STT (Whisper) and TTS (Piper) services on Mac mini</p>
                </div>
                <div id="voice-config-content">
                    <div class="text-center text-gray-400 py-12">
                        <div class="text-4xl mb-4 animate-pulse">🎙️</div>
                        <p>Loading voice configuration...</p>
                    </div>
                </div>
            </div>

            <!-- Voice Testing Tab -->
            <div id="tab-voice-testing" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Voice Testing</h2>
                    <button onclick="loadTestHistory()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh History
                    </button>
                </div>

                <!-- Component Tests Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <!-- LLM Test -->
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">🧠 LLM Processing</h3>
                        <textarea id="llm-prompt" placeholder="Enter prompt to test LLM..."
                            class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-gray-200 text-sm mb-3"
                            rows="3"></textarea>
                        <select id="llm-model" class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-gray-200 text-sm mb-3">
                            <option value="phi3:mini">Phi-3 Mini (Fast)</option>
                            <option value="llama3.1:8b">Llama 3.1 8B (Balanced)</option>
                        </select>
                        <button onclick="testLLM()" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            Run LLM Test
                        </button>
                        <div id="llm-results" class="mt-4"></div>
                    </div>

                    <!-- RAG Query Test -->
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">🔍 RAG Query</h3>
                        <textarea id="rag-query" placeholder="Enter city name (e.g., Seattle, Boston)..."
                            class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-gray-200 text-sm mb-3"
                            rows="3"></textarea>
                        <select id="rag-connector" onchange="updateRAGPlaceholder()" class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-gray-200 text-sm mb-3">
                            <option value="weather">Weather</option>
                            <option value="airports">Airports</option>
                            <option value="sports">Sports</option>
                            <option value="flights">Flights</option>
                            <option value="events">Events</option>
                            <option value="streaming">Streaming</option>
                            <option value="news">News</option>
                            <option value="stocks">Stocks</option>
                            <option value="websearch">Web Search</option>
                            <option value="dining">Dining</option>
                            <option value="recipes">Recipes</option>
                        </select>
                        <button onclick="testRAG()" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            Run RAG Test
                        </button>
                        <div id="rag-results" class="mt-4"></div>
                    </div>
                </div>

                <!-- Full Pipeline Test -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-8">
                    <h3 class="text-lg font-semibold text-white mb-4">🚀 Full Pipeline Test</h3>
                    <textarea id="pipeline-text" placeholder="Enter query to test full pipeline..."
                        class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-gray-200 text-sm mb-3"
                        rows="3"></textarea>
                    <button onclick="testFullPipeline()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm font-medium transition-colors">
                        Run Full Pipeline Test
                    </button>
                    <div id="pipeline-results" class="mt-4"></div>
                    <div id="pipeline-timings" class="mt-4"></div>
                </div>

                <!-- Test History -->
                <div>
                    <h3 class="text-lg font-semibold text-white mb-4">📜 Test History</h3>
                    <div id="test-history-container" class="space-y-4"></div>
                </div>
            </div>

            <!-- Admin Jarvis Tab (Real-time Pipeline Monitoring) -->
            <div id="tab-admin-jarvis" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Admin Jarvis - Pipeline Monitor</h2>
                    <div class="flex gap-2 items-center">
                        <select id="aj-connection-mode" onchange="toggleConnectionMode()" class="px-3 py-1 bg-dark-bg border border-dark-border rounded-lg text-gray-200 text-sm">
                            <option value="websocket">WebSocket (Real-time)</option>
                            <option value="polling">REST Polling (Fallback)</option>
                        </select>
                        <span id="ws-status" class="px-3 py-1 rounded-full text-sm font-medium bg-gray-700 text-gray-400">
                            ⚪ Disconnected
                        </span>
                        <button onclick="toggleWebSocketConnection()" id="ws-toggle-btn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            🔌 Connect
                        </button>
                        <button onclick="clearEventLog()" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm font-medium transition-colors">
                            🗑️ Clear Log
                        </button>
                    </div>
                </div>

                <!-- Connection Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-dark-card border border-dark-border rounded-lg p-4">
                        <div class="text-2xl font-bold text-blue-400" id="aj-events-count">0</div>
                        <div class="text-sm text-gray-400">Events Received</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-4">
                        <div class="text-2xl font-bold text-green-400" id="aj-sessions-count">0</div>
                        <div class="text-sm text-gray-400">Active Sessions</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-4">
                        <div class="text-2xl font-bold text-purple-400" id="aj-tools-count">0</div>
                        <div class="text-sm text-gray-400">Tool Calls</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-4">
                        <div class="text-2xl font-bold text-yellow-400" id="aj-avg-latency">-</div>
                        <div class="text-sm text-gray-400">Avg Latency (ms)</div>
                    </div>
                </div>

                <!-- Active Sessions Panel -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold text-white mb-4">🔄 Active Pipeline Sessions</h3>
                    <div id="aj-active-sessions" class="space-y-3">
                        <p class="text-gray-500 text-sm">No active sessions. Connect to start monitoring.</p>
                    </div>
                </div>

                <!-- Event Stream -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">📡 Event Stream</h3>
                        <div class="flex gap-2">
                            <select id="aj-event-filter" onchange="filterEvents()" class="px-3 py-1 bg-dark-bg border border-dark-border rounded-lg text-gray-200 text-sm">
                                <option value="all">All Events</option>
                                <option value="session_start">Session Start</option>
                                <option value="intent_detected">Intent Detected</option>
                                <option value="tool_selected">Tool Selected</option>
                                <option value="tool_result">Tool Result</option>
                                <option value="response_generated">Response Generated</option>
                                <option value="session_end">Session End</option>
                                <option value="error">Errors</option>
                            </select>
                            <label class="flex items-center gap-2 text-gray-400 text-sm">
                                <input type="checkbox" id="aj-auto-scroll" checked class="rounded">
                                Auto-scroll
                            </label>
                        </div>
                    </div>
                    <div id="aj-event-log" class="h-96 overflow-y-auto bg-dark-bg rounded-lg p-4 font-mono text-sm space-y-2">
                        <p class="text-gray-500">Waiting for events...</p>
                    </div>
                </div>

                <!-- Tool Proposals Section (Self-Building Tools) -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">🛠️ Tool Proposals</h3>
                        <div class="flex items-center gap-4">
                            <!-- Auto-Approve Toggle -->
                            <div class="flex items-center gap-2">
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="aj-auto-approve-toggle" class="sr-only peer" onchange="toggleAutoApprove()">
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow-600"></div>
                                </label>
                                <span id="aj-auto-approve-status" class="text-gray-400 text-sm">OFF - Manual approval required</span>
                            </div>
                            <button onclick="loadToolProposals()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                                <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <p class="text-gray-400 text-sm mb-4">
                        LLM-proposed tools awaiting approval. Review and approve to deploy as n8n workflows.
                    </p>
                    <div id="aj-tool-proposals" class="space-y-4">
                        <p class="text-gray-500 text-sm">No pending tool proposals.</p>
                    </div>
                </div>
            </div>

            <!-- Hallucination Checks Tab -->
            <div id="tab-hallucination-checks" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Hallucination Checks</h2>
                    <button onclick="showCreateHallucinationCheckModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                        ➕ Create Check
                    </button>
                </div>
                <div id="hallucination-checks-container" class="space-y-4"></div>
            </div>

            <!-- Multi-Intent Config Tab -->
            <div id="tab-multi-intent" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Multi-Intent Configuration</h2>
                    <button onclick="loadMultiIntentConfig()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>

                <!-- Multi-Intent Settings -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold text-white mb-4">Configuration</h3>
                    <div id="multi-intent-config-container"></div>
                </div>

                <!-- Intent Chain Rules -->
                <div>
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Intent Chain Rules</h3>
                        <button onclick="showCreateIntentChainModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ➕ Create Chain
                        </button>
                    </div>
                    <div id="intent-chains-container" class="space-y-4"></div>
                </div>
            </div>

            <!-- Validation Models Tab -->
            <div id="tab-validation-models" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Validation Models</h2>
                    <button onclick="showCreateValidationModelModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                        ➕ Add Model
                    </button>
                </div>
                <div id="validation-models-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>

            <!-- LLM Backends Tab -->
            <div id="tab-llm-backends" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">LLM Backend Management</h2>
                    <div class="flex gap-3">
                        <button onclick="loadLLMBackends()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                        </button>
                        <button onclick="showCreateBackendModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ➕ Add Backend
                        </button>
                    </div>
                </div>

                <!-- Backend Performance Summary -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6" id="backend-stats-container">
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <div class="text-3xl font-bold text-blue-400" id="stat-total-backends">-</div>
                        <div class="text-sm text-gray-400 mt-1">Total Backends</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <div class="text-3xl font-bold text-green-400" id="stat-enabled-backends">-</div>
                        <div class="text-sm text-gray-400 mt-1">Enabled</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <div class="text-3xl font-bold text-yellow-400" id="stat-avg-tokens-per-sec">-</div>
                        <div class="text-sm text-gray-400 mt-1">Avg Tokens/Sec</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <div class="text-3xl font-bold text-purple-400" id="stat-total-requests">-</div>
                        <div class="text-sm text-gray-400 mt-1">Total Requests</div>
                    </div>
                </div>

                <!-- LLM Memory Settings -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-white">LLM Memory Settings</h3>
                            <p class="text-sm text-gray-400 mt-1">Control how long models stay loaded in memory</p>
                        </div>
                        <button onclick="saveLLMMemorySettings()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            Save Settings
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="llm-keep-models-loaded" class="w-5 h-5 rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-gray-800" checked>
                                <div>
                                    <span class="text-white font-medium">Keep Models Loaded</span>
                                    <p class="text-xs text-gray-400">When enabled, models stay in memory to avoid cold start delays</p>
                                </div>
                            </label>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Default Keep Alive Duration</label>
                            <select id="llm-keep-alive-seconds" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="-1">Forever (until manually unloaded)</option>
                                <option value="300">5 minutes</option>
                                <option value="600">10 minutes</option>
                                <option value="1800">30 minutes</option>
                                <option value="3600">1 hour</option>
                                <option value="0">Unload immediately after request</option>
                            </select>
                            <p class="text-xs text-gray-400 mt-1" id="llm-keep-alive-description">Models stay loaded forever (until manually unloaded)</p>
                        </div>
                    </div>
                </div>

                <!-- Backends List -->
                <div id="llm-backends-container" class="space-y-4"></div>
            </div>

            <!-- Model Configuration Tab -->
            <div id="tab-model-config" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-semibold text-white">Model Configuration</h2>
                        <p class="text-gray-400 text-sm mt-1">Configure Ollama/MLX execution options for each model</p>
                    </div>
                    <button onclick="loadModelConfigs()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>
                <div id="model-configs-container" class="space-y-4"></div>
            </div>

            <!-- Model Downloads Tab -->
            <div id="tab-model-downloads" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-semibold text-white">Model Downloads</h2>
                        <p class="text-gray-400 text-sm mt-1">Download models from Hugging Face Hub</p>
                    </div>
                    <button onclick="loadDownloads()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>
                <div id="model-downloads-container" class="space-y-4"></div>
            </div>

            <!-- Cloud Providers Tab -->
            <div id="tab-cloud-providers" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-semibold text-white">Cloud LLM Providers</h2>
                        <p class="text-gray-400 text-sm mt-1">Configure OpenAI, Anthropic, and Google cloud providers</p>
                    </div>
                    <button onclick="loadCloudProviders()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>

                <!-- Provider Cards -->
                <div id="cloud-providers-container" class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Provider cards will be loaded dynamically -->
                </div>

                <!-- Usage Dashboard -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Usage & Costs</h3>
                        <select id="usage-period" onchange="loadUsageSummary()" class="bg-dark-bg border border-dark-border rounded-lg px-3 py-2 text-white text-sm">
                            <option value="today">Today</option>
                            <option value="week" selected>This Week</option>
                            <option value="month">This Month</option>
                        </select>
                    </div>
                    <div id="usage-summary-container" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <!-- Usage summary cards -->
                    </div>
                </div>

                <!-- Cost Analytics Chart -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold text-white mb-4">Daily Cost Trend</h3>
                    <div id="cost-chart-container" class="h-64">
                        <!-- Chart will be rendered here -->
                    </div>
                </div>

                <!-- Recent Usage Table -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Recent API Calls</h3>
                        <button onclick="loadRecentUsage()" class="text-blue-400 hover:text-blue-300 text-sm">
                            View All
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="text-left text-gray-400 border-b border-dark-border">
                                    <th class="pb-3">Time</th>
                                    <th class="pb-3">Provider</th>
                                    <th class="pb-3">Model</th>
                                    <th class="pb-3">Tokens</th>
                                    <th class="pb-3">Cost</th>
                                    <th class="pb-3">Latency</th>
                                </tr>
                            </thead>
                            <tbody id="recent-usage-table">
                                <!-- Recent usage rows -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Service Bypass Tab -->
            <div id="tab-service-bypass" class="tab-content hidden">
                <div id="service-bypass-container">
                    <div class="text-center py-8 text-gray-400">Loading service bypass configuration...</div>
                </div>
            </div>

            <!-- Conversation Context Tab -->
            <div id="tab-conversation-context" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Conversation Context Settings</h2>
                    <button onclick="loadConversationSettings()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>

                <!-- Main Settings Card -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold text-white mb-4">General Settings</h3>
                    <div id="conversation-settings-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Dynamic settings will be loaded here -->
                        <div class="col-span-2 text-center text-gray-400 py-8">
                            <div class="text-2xl mb-2">⏳</div>
                            <p>Click Refresh to load settings...</p>
                        </div>
                    </div>
                </div>

                <!-- Clarification System -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Clarification System</h3>
                        <button onclick="showCreateClarificationTypeModal()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ℹ️ About Types
                        </button>
                    </div>
                    <div id="clarification-types-container" class="space-y-4">
                        <!-- Clarification types will be loaded here -->
                    </div>
                </div>

                <!-- Sports Teams -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Sports Team Disambiguation</h3>
                        <button onclick="showCreateSportsTeamModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ➕ Add Team
                        </button>
                    </div>
                    <div id="sports-teams-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Sports teams will be loaded here -->
                    </div>
                </div>

                <!-- Analytics -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-white mb-4">Conversation Analytics</h3>
                    <div id="conversation-analytics-container" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <!-- Analytics will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Intent Routing Tab -->
            <div id="tab-intent-routing" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Intent Routing Configuration</h2>
                    <button onclick="loadIntentRoutingData()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>

                <!-- Routing Strategy Configuration (Cascading Fallback System) -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Routing Strategy</h3>
                        <span class="text-xs text-gray-400">Configure how each intent is routed (cascading fallback system)</span>
                    </div>
                    <p class="text-sm text-gray-400 mb-4">
                        <strong>Cascading</strong> = Try direct RAG first, fallback to tool calling on failure (recommended) &nbsp;|&nbsp;
                        <strong>Always Tool Calling</strong> = Skip RAG, always use LLM &nbsp;|&nbsp;
                        <strong>Direct Only</strong> = Never fallback
                    </p>
                    <div id="strategy-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                        <!-- Strategy configs will be loaded here -->
                        <div class="col-span-4 text-center text-gray-400 py-8">
                            <div class="text-2xl mb-2">⏳</div>
                            <p>Click Refresh to load strategy configs...</p>
                        </div>
                    </div>
                </div>

                <!-- Intent Patterns -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Intent Classification Patterns</h3>
                        <button onclick="showCreatePatternModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ➕ Add Pattern
                        </button>
                    </div>
                    <div class="mb-4">
                        <input type="text" id="pattern-search" placeholder="Search patterns..."
                            onkeyup="filterPatterns()"
                            class="w-full px-4 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="text-xs text-gray-400 uppercase bg-dark-bg">
                                <tr>
                                    <th class="px-6 py-3 cursor-pointer" onclick="sortPatterns('category')">
                                        Intent Category <span id="sort-category">↕️</span>
                                    </th>
                                    <th class="px-6 py-3 cursor-pointer" onclick="sortPatterns('keyword')">
                                        Keyword <span id="sort-keyword">↕️</span>
                                    </th>
                                    <th class="px-6 py-3 cursor-pointer" onclick="sortPatterns('priority')">
                                        Priority <span id="sort-priority">↕️</span>
                                    </th>
                                    <th class="px-6 py-3">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="patterns-table-body" class="divide-y divide-dark-border">
                                <!-- Patterns will be loaded here -->
                                <tr>
                                    <td colspan="4" class="px-6 py-8 text-center text-gray-400">
                                        <div class="text-2xl mb-2">⏳</div>
                                        <p>Click Refresh to load patterns...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Intent Routing Configuration -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Intent Routing Rules</h3>
                        <button onclick="showCreateRoutingModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ➕ Add Routing Rule
                        </button>
                    </div>
                    <div id="routing-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Routing rules will be loaded here -->
                        <div class="col-span-2 text-center text-gray-400 py-8">
                            <div class="text-2xl mb-2">⏳</div>
                            <p>Click Refresh to load routing rules...</p>
                        </div>
                    </div>
                </div>

                <!-- Provider Routing -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Search Provider Routing</h3>
                        <button onclick="showCreateProviderRoutingModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ➕ Add Provider Mapping
                        </button>
                    </div>
                    <div id="provider-routing-container" class="space-y-4">
                        <!-- Provider routing will be loaded here -->
                        <div class="text-center text-gray-400 py-8">
                            <div class="text-2xl mb-2">⏳</div>
                            <p>Click Refresh to load provider routing...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Metrics Tab -->
            <div id="tab-performance-metrics" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">LLM Performance Metrics</h2>
                    <div class="flex gap-3">
                        <button onclick="clearFilters()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-medium transition-colors">
                            Clear Filters
                        </button>
                        <button onclick="applyFilters()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold text-white mb-4">Filters</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-2">Model</label>
                            <input type="text" id="filter-model" placeholder="e.g., phi3:mini"
                                class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-2">Backend</label>
                            <select id="filter-backend" class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-blue-500">
                                <option value="">All Backends</option>
                                <option value="ollama">Ollama</option>
                                <option value="mlx">MLX</option>
                                <option value="auto">Auto</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-2">Limit</label>
                            <select id="filter-limit" class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white focus:outline-none focus:border-blue-500">
                                <option value="100">100 records</option>
                                <option value="250">250 records</option>
                                <option value="500">500 records</option>
                                <option value="1000">1000 records</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Statistics Summary -->
                <div id="metrics-stats-container" class="mb-6">
                    <!-- Stats will be loaded here -->
                </div>

                <!-- Performance Chart -->
                <div id="metrics-chart-container" class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <!-- Chart will be loaded here -->
                </div>

                <!-- Metrics Table -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-white mb-4">Recent Metrics</h3>
                    <div id="metrics-table-container" class="overflow-x-auto">
                        <!-- Table will be loaded here -->
                        <div class="text-center text-gray-400 py-8">
                            <div class="text-2xl mb-2">⏳</div>
                            <p>Click Refresh to load metrics...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Intent Analytics Tab -->
            <div id="tab-intent-analytics" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Intent Analytics</h2>
                    <div class="flex gap-3">
                        <select id="analytics-time-range" onchange="handleTimeRangeChange(event)" class="px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-white text-sm">
                            <option value="7">Last 7 Days</option>
                            <option value="14">Last 14 Days</option>
                            <option value="30">Last 30 Days</option>
                            <option value="90">Last 90 Days</option>
                        </select>
                        <button onclick="loadIntentAnalytics(selectedDays)" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Analytics Summary -->
                <div id="analytics-summary" class="mb-6">
                    <!-- Summary stats will be loaded here -->
                </div>

                <!-- Intents Table -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold text-white mb-4">Query Intents</h3>
                    <div id="intents-table-container">
                        <div class="text-center text-gray-400 py-8">
                            <div class="text-2xl mb-2">🎯</div>
                            <p>Click Refresh to load intent data...</p>
                        </div>
                    </div>
                </div>

                <!-- Service Gaps Analysis -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                    <div id="service-gaps-container">
                        <!-- Service gaps will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Features Tab -->
            <div id="tab-features" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Feature Flags</h2>
                    <button onclick="initFeaturesPage()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>
                <div id="features-container">
                    <!-- Features will be loaded here -->
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-2xl mb-2">🎛️</div>
                        <p>Click Refresh to load feature flags...</p>
                    </div>
                </div>
            </div>

            <!-- System Configuration Tab -->
            <div id="tab-system-config" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">System Configuration</h2>
                    <p class="text-sm text-gray-400">Unified view of all HA voice optimization settings</p>
                </div>
                <div id="system-config-container">
                    <!-- System config will be loaded here -->
                    <div class="text-center text-gray-400 py-12">
                        <div class="text-4xl mb-4">⚙️</div>
                        <p>Loading system configuration...</p>
                    </div>
                </div>
            </div>

            <!-- Presets Tab -->
            <div id="tab-presets" class="tab-content hidden">
                <div id="presets-container">
                    <!-- Presets will be loaded here -->
                    <div class="text-center text-gray-400 py-12">
                        <div class="text-4xl mb-4">⚡</div>
                        <p>Loading presets...</p>
                    </div>
                </div>
            </div>

            <!-- Emerging Intents Tab -->
            <div id="tab-emerging-intents" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Emerging Intents</h2>
                    <button onclick="loadEmergingIntents()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>
                <div class="mb-4 p-4 bg-purple-900/20 border border-purple-500/30 rounded-lg">
                    <p class="text-sm text-purple-200">
                        <strong>Intent Discovery</strong> automatically captures user requests that don't match existing services.
                        Review, promote, or reject discovered intents to inform service development priorities.
                    </p>
                </div>
                <div id="emerging-intents-container">
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-2xl mb-2">🔍</div>
                        <p>Click Refresh to load emerging intents...</p>
                    </div>
                </div>
            </div>

            <!-- Tool Calling Settings Tab -->
            <div id="tab-tool-calling-settings" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Tool Calling Settings</h2>
                    <button onclick="loadToolCallingSettings()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>
                <div id="tool-calling-settings-container" class="space-y-6">
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-2xl mb-2">⚙️</div>
                        <p>Loading tool calling settings...</p>
                    </div>
                </div>
            </div>

            <!-- Tool Registry Tab -->
            <div id="tab-tool-registry" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Tool Registry</h2>
                    <div class="flex gap-2">
                        <button onclick="showCreateToolModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ➕ Add Tool
                        </button>
                        <button onclick="loadToolRegistry()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div class="mb-4 flex gap-4">
                    <select id="tool-category-filter" onchange="filterTools()" class="px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-white text-sm">
                        <option value="">All Categories</option>
                        <option value="rag">RAG Tools</option>
                        <option value="smart_home">Smart Home</option>
                        <option value="api">External APIs</option>
                    </select>
                    <label class="flex items-center gap-2 text-sm text-gray-400">
                        <input type="checkbox" id="enabled-only-filter" onchange="filterTools()" class="rounded">
                        <span>Enabled Only</span>
                    </label>
                    <label class="flex items-center gap-2 text-sm text-gray-400">
                        <input type="checkbox" id="guest-allowed-filter" onchange="filterTools()" class="rounded">
                        <span>Guest Mode Allowed</span>
                    </label>
                </div>

                <div id="tool-registry-container" class="space-y-4">
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-2xl mb-2">🛠️</div>
                        <p>Loading tool registry...</p>
                    </div>
                </div>
            </div>

            <!-- Trigger Configuration Tab -->
            <div id="tab-trigger-config" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Trigger Configuration</h2>
                    <button onclick="loadTriggers()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>

                <div class="mb-4 p-4 bg-dark-card border border-dark-border rounded-lg">
                    <p class="text-sm text-gray-400">
                        <strong class="text-white">Fallback Triggers:</strong> These determine when the system should switch from the fast path (pattern-based routing) to the smart path (LLM tool calling).
                        Higher priority values are checked first.
                    </p>
                </div>

                <div id="triggers-container" class="space-y-4">
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-2xl mb-2">🎯</div>
                        <p>Loading trigger configuration...</p>
                    </div>
                </div>
            </div>

            <!-- Tool Metrics Tab -->
            <div id="tab-tool-metrics" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Tool Calling Metrics</h2>
                    <div class="flex gap-2">
                        <select id="metrics-timeframe" onchange="loadToolMetrics()" class="px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-white text-sm">
                            <option value="1h">Last Hour</option>
                            <option value="24h" selected>Last 24 Hours</option>
                            <option value="7d">Last 7 Days</option>
                            <option value="30d">Last 30 Days</option>
                        </select>
                        <button onclick="loadToolMetrics()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Summary Stats -->
                <div class="stats-grid mb-6">
                    <div class="stat-card">
                        <div class="stat-label">Total Tool Calls</div>
                        <div class="stat-value" id="metric-total-calls">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Success Rate</div>
                        <div class="stat-value" id="metric-success-rate">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Latency</div>
                        <div class="stat-value" id="metric-avg-latency">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Most Used Tool</div>
                        <div class="stat-value text-lg" id="metric-top-tool">-</div>
                    </div>
                </div>

                <div id="tool-metrics-container">
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-2xl mb-2">📊</div>
                        <p>Loading tool calling metrics...</p>
                    </div>
                </div>
            </div>

            <!-- Tool Testing Tab -->
            <div id="tab-tool-testing" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Tool Testing</h2>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Test Input Panel -->
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Test Configuration</h3>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Select Tool</label>
                                <select id="test-tool-select" class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                                    <option value="">-- Select a tool --</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Tool Arguments (JSON)</label>
                                <textarea id="test-tool-args" rows="8" class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white font-mono text-sm" placeholder='{\n  "location": "Baltimore",\n  "days": 3\n}'></textarea>
                            </div>

                            <div>
                                <label class="flex items-center gap-2 text-sm text-gray-400">
                                    <input type="checkbox" id="test-guest-mode" class="rounded">
                                    <span>Test in Guest Mode</span>
                                </label>
                            </div>

                            <button onclick="testTool()" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors">
                                🧪 Run Test
                            </button>
                        </div>
                    </div>

                    <!-- Test Results Panel -->
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Test Results</h3>

                        <div id="test-results-container" class="space-y-4">
                            <div class="text-center text-gray-400 py-12">
                                <div class="text-4xl mb-2">🧪</div>
                                <p>Select a tool and run a test to see results here</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Test History -->
                <div class="mt-6 bg-dark-card border border-dark-border rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-white mb-4">Recent Tests</h3>
                    <div id="test-history-container">
                        <div class="text-center text-gray-400 py-8">
                            <p>No recent tests</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Escalation Tab -->
            <div id="tab-escalation" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Model Escalation</h2>
                    <button onclick="loadEscalationPresets(); loadOverrides(); loadEscalationStats(); loadRecentEvents();" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                    </button>
                </div>

                <div class="mb-4 p-4 bg-dark-card border border-dark-border rounded-lg">
                    <p class="text-sm text-gray-400">
                        <strong class="text-white">Model Escalation:</strong> Automatically upgrade from smaller/faster models to larger/smarter models when confusion, user frustration, or failures are detected.
                        Switch between presets to change escalation behavior. Higher priority rules are checked first.
                    </p>
                </div>

                <!-- Metrics Section -->
                <div id="metrics-container" class="mb-6">
                    <div class="text-center text-gray-400 py-4">
                        <p>Loading metrics...</p>
                    </div>
                </div>

                <!-- Recent Events Section -->
                <div id="recent-events-container" class="mb-6">
                    <div class="text-center text-gray-400 py-4">
                        <p>Loading recent events...</p>
                    </div>
                </div>

                <!-- Manual Overrides Section -->
                <div id="overrides-container" class="mb-6">
                    <div class="text-center text-gray-400 py-4">
                        <p>Loading overrides...</p>
                    </div>
                </div>

                <!-- Presets Section -->
                <div id="escalation-container" class="space-y-4">
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-2xl mb-2">📈</div>
                        <p>Loading escalation presets...</p>
                    </div>
                </div>
            </div>

            <!-- Debug Logs Tab -->
            <div id="tab-debug-logs" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center gap-4">
                        <h2 class="text-2xl font-semibold text-white">Debug Logs</h2>
                        <span id="debug-mode-status" class="px-3 py-1 bg-gray-700 text-gray-400 rounded-full text-sm">
                            Checking status...
                        </span>
                    </div>
                    <div class="flex items-center gap-3">
                        <!-- View Mode Toggle -->
                        <div class="flex bg-gray-800 rounded-lg p-1">
                            <button class="view-mode-btn px-3 py-1.5 rounded text-sm font-medium transition-colors bg-purple-600 text-white" data-mode="raw">
                                <i data-lucide="align-left" class="w-4 h-4 inline mr-1"></i>Raw
                            </button>
                            <button class="view-mode-btn px-3 py-1.5 rounded text-sm font-medium transition-colors bg-gray-700 text-gray-400" data-mode="table">
                                <i data-lucide="table" class="w-4 h-4 inline mr-1"></i>Table
                            </button>
                        </div>
                        <button id="log-tail-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="chevrons-down" class="w-4 h-4 inline mr-1"></i>Tail
                        </button>
                        <button id="log-refresh-btn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i>
                        </button>
                    </div>
                </div>

                <!-- Stats bar -->
                <div id="debug-stats" class="mb-4 px-4 py-2 bg-gray-800/50 rounded-lg text-sm flex items-center">
                    <span class="text-gray-400">Loading log stats...</span>
                </div>

                <div class="flex gap-6">
                    <!-- File list sidebar -->
                    <div class="w-64 flex-shrink-0">
                        <div class="bg-gray-900 border border-gray-700 rounded-lg p-3">
                            <h3 class="text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2">
                                <i data-lucide="folder" class="w-4 h-4"></i>
                                Log Files
                            </h3>
                            <div id="log-file-list" class="space-y-1 max-h-96 overflow-y-auto">
                                <div class="text-center py-4 text-gray-500 text-sm">Loading files...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Main log viewer -->
                    <div class="flex-1 min-w-0">
                        <!-- Search and filter bar -->
                        <div class="mb-4 flex items-center gap-3">
                            <div class="relative flex-1">
                                <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"></i>
                                <input
                                    type="text"
                                    id="log-search-input"
                                    placeholder="Search logs (regex supported)..."
                                    class="w-full pl-10 pr-10 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:border-purple-500"
                                >
                                <button onclick="clearSearch()" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300">
                                    <i data-lucide="x" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <select id="log-level-filter" class="px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white text-sm focus:outline-none focus:border-purple-500">
                                <option value="all">All Levels</option>
                                <option value="debug">Debug</option>
                                <option value="info">Info</option>
                                <option value="warning">Warning</option>
                                <option value="error">Error</option>
                            </select>
                            <label class="flex items-center gap-2 text-sm text-gray-400 cursor-pointer">
                                <input type="checkbox" id="log-auto-refresh" class="w-4 h-4 rounded border-gray-600 bg-gray-800 text-purple-600 focus:ring-purple-500">
                                Auto-refresh
                            </label>
                        </div>

                        <!-- Log entries stats -->
                        <div class="mb-2 flex items-center justify-between text-sm">
                            <span id="log-entries-stats" class="text-gray-500">No entries loaded</span>
                        </div>

                        <!-- Log entries container -->
                        <div class="relative bg-gray-900 border border-gray-700 rounded-lg overflow-hidden" style="height: calc(100vh - 380px);">
                            <div id="log-entries" class="overflow-auto h-full p-3">
                                <div class="text-center py-12 text-gray-500">
                                    <i data-lucide="file-text" class="w-12 h-12 mx-auto mb-4 opacity-30"></i>
                                    <p>Select a log file to view entries</p>
                                </div>
                            </div>
                            <div id="log-loading-overlay" class="hidden absolute inset-0 bg-gray-900/80 flex items-center justify-center">
                                <div class="flex items-center gap-3 text-gray-400">
                                    <i data-lucide="loader-2" class="w-6 h-6 animate-spin"></i>
                                    <span>Loading logs...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Base Knowledge Tab -->
            <div id="tab-base-knowledge" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Base Knowledge Management</h2>
                    <div class="flex gap-2">
                        <button onclick="showCreateKnowledgeModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ➕ Add Entry
                        </button>
                        <button onclick="loadBaseKnowledge()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                        </button>
                    </div>
                </div>

                <div class="mb-4 p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg">
                    <p class="text-sm text-blue-200">
                        <strong>Base Knowledge</strong> provides context-aware information that gets injected into LLM prompts.
                        Use categories to organize knowledge (property, location, user, temporal, general) and applies_to to control guest/owner visibility.
                    </p>
                </div>

                <!-- Filter Bar -->
                <div class="mb-4 flex gap-4 flex-wrap">
                    <select id="knowledge-category-filter" onchange="filterBaseKnowledge()" class="px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-white text-sm">
                        <option value="">All Categories</option>
                        <option value="property">Property</option>
                        <option value="location">Location</option>
                        <option value="user">User Context</option>
                        <option value="temporal">Temporal</option>
                        <option value="general">General</option>
                    </select>
                    <select id="knowledge-applies-filter" onchange="filterBaseKnowledge()" class="px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-white text-sm">
                        <option value="">All Applies To</option>
                        <option value="both">Both</option>
                        <option value="guest">Guest Only</option>
                        <option value="owner">Owner Only</option>
                    </select>
                    <label class="flex items-center gap-2 text-sm text-gray-400">
                        <input type="checkbox" id="knowledge-enabled-filter" onchange="filterBaseKnowledge()" checked class="rounded">
                        <span>Enabled Only</span>
                    </label>
                </div>

                <!-- Knowledge Entries Table -->
                <div id="base-knowledge-container" class="bg-dark-card border border-dark-border rounded-lg overflow-hidden">
                    <div class="text-center text-gray-400 py-8">
                        <div class="text-2xl mb-2">📚</div>
                        <p>Loading base knowledge entries...</p>
                    </div>
                </div>
            </div>

            <!-- Memory Management Tab -->
            <div id="tab-memory-management" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Memory Management</h2>
                    <div class="flex items-center gap-4">
                        <div id="qdrant-status" class="text-sm">
                            <span class="px-2 py-1 text-xs rounded-full bg-gray-700 text-gray-400">Checking Qdrant...</span>
                        </div>
                        <button onclick="loadAllMemoryData()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            Refresh
                        </button>
                    </div>
                </div>

                <div class="mb-4 p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg">
                    <p class="text-sm text-blue-200">
                        <strong>Hierarchical Memory System</strong> manages knowledge with three scopes:
                        <strong>Global</strong> (everyone), <strong>Owner</strong> (property owner only), and <strong>Guest</strong> (per-stay).
                        Guest memories are isolated to each rental period and can be promoted to permanent storage.
                    </p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <div class="text-3xl font-bold text-purple-400" id="stat-global-memories">-</div>
                        <div class="text-sm text-gray-400 mt-1">Global Memories</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <div class="text-3xl font-bold text-blue-400" id="stat-owner-memories">-</div>
                        <div class="text-sm text-gray-400 mt-1">Owner Memories</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <div class="text-3xl font-bold text-green-400" id="stat-guest-memories">-</div>
                        <div class="text-sm text-gray-400 mt-1">Guest Memories</div>
                    </div>
                </div>

                <!-- Sub-Tab Navigation -->
                <div class="flex gap-2 mb-4 border-b border-dark-border pb-4">
                    <button id="memory-subtab-btn-memories" onclick="showMemorySubTab('memories')"
                            class="memory-subtab-btn px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-blue-600 text-white">
                        Memories
                    </button>
                    <button id="memory-subtab-btn-sessions" onclick="showMemorySubTab('sessions')"
                            class="memory-subtab-btn px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-dark-card text-gray-400">
                        Guest Sessions
                    </button>
                    <button id="memory-subtab-btn-search" onclick="showMemorySubTab('search')"
                            class="memory-subtab-btn px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-dark-card text-gray-400">
                        Semantic Search
                    </button>
                    <button id="memory-subtab-btn-config" onclick="showMemorySubTab('config')"
                            class="memory-subtab-btn px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-dark-card text-gray-400">
                        Configuration
                    </button>
                </div>

                <!-- Memories Sub-Tab -->
                <div id="memory-subtab-memories" class="memory-subtab">
                    <!-- Filter Bar -->
                    <div class="mb-4 flex gap-4 flex-wrap items-center">
                        <select id="memory-scope-filter" onchange="loadMemories()" class="px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-white text-sm">
                            <option value="">All Scopes</option>
                            <option value="global">Global</option>
                            <option value="owner">Owner</option>
                            <option value="guest">Guest</option>
                        </select>
                        <select id="memory-session-filter" onchange="loadMemories()" class="px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-white text-sm">
                            <option value="">All Sessions</option>
                        </select>
                        <select id="memory-category-filter" onchange="loadMemories()" class="px-3 py-2 bg-dark-card border border-dark-border rounded-lg text-white text-sm">
                            <option value="">All Categories</option>
                            <option value="preference">Preference</option>
                            <option value="fact">Fact</option>
                            <option value="interaction">Interaction</option>
                            <option value="request">Request</option>
                            <option value="feedback">Feedback</option>
                        </select>
                        <button onclick="showCreateMemoryModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors ml-auto">
                            Add Memory
                        </button>
                    </div>

                    <!-- Memories Table -->
                    <div id="memories-container" class="bg-dark-card border border-dark-border rounded-lg overflow-hidden">
                        <div class="text-center text-gray-400 py-8">
                            <div class="text-2xl mb-2">🧠</div>
                            <p>Loading memories...</p>
                        </div>
                    </div>
                </div>

                <!-- Guest Sessions Sub-Tab -->
                <div id="memory-subtab-sessions" class="memory-subtab hidden">
                    <div id="guest-sessions-container" class="bg-dark-card border border-dark-border rounded-lg overflow-hidden">
                        <div class="text-center text-gray-400 py-8">
                            <div class="text-2xl mb-2">🏠</div>
                            <p>Loading guest sessions...</p>
                        </div>
                    </div>
                </div>

                <!-- Semantic Search Sub-Tab -->
                <div id="memory-subtab-search" class="memory-subtab hidden">
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-4">
                        <h3 class="text-lg font-semibold text-white mb-4">Search Memories</h3>
                        <div class="flex gap-4 flex-wrap items-end">
                            <div class="flex-1 min-w-64">
                                <label class="block text-sm text-gray-400 mb-1">Query</label>
                                <input type="text" id="memory-search-input" placeholder="Enter your search query..."
                                       class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white"
                                       onkeypress="if(event.key==='Enter')searchMemories()">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">Scope</label>
                                <select id="memory-search-scope" class="px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm">
                                    <option value="">All Scopes</option>
                                    <option value="global">Global</option>
                                    <option value="owner">Owner</option>
                                    <option value="guest">Guest</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">Mode</label>
                                <select id="memory-search-mode" class="px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm">
                                    <option value="owner">Owner</option>
                                    <option value="guest">Guest</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-1">Limit</label>
                                <input type="number" id="memory-search-limit" value="10" min="1" max="50"
                                       class="w-20 px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm">
                            </div>
                            <button onclick="searchMemories()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                                Search
                            </button>
                        </div>
                    </div>
                    <div id="memory-search-results">
                        <div class="text-center text-gray-400 py-8">
                            <div class="text-2xl mb-2">🔍</div>
                            <p>Enter a query to search memories semantically</p>
                        </div>
                    </div>
                </div>

                <!-- Configuration Sub-Tab -->
                <div id="memory-subtab-config" class="memory-subtab hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Memory Configuration</h3>
                        <button onclick="seedDefaultConfig()" class="px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg text-sm font-medium transition-colors">
                            Seed Defaults
                        </button>
                    </div>
                    <div id="memory-config-container">
                        <div class="text-center text-gray-400 py-8">
                            <div class="text-2xl mb-2">⚙️</div>
                            <p>Loading configuration...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Memory Modal -->
            <div id="memory-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50" onclick="closeMemoryModal(event)">
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 w-full max-w-lg mx-4" onclick="event.stopPropagation()">
                    <div class="flex justify-between items-center mb-4">
                        <h3 id="memory-modal-title" class="text-xl font-semibold text-white">Create Memory</h3>
                        <button onclick="closeMemoryModal()" class="close-btn text-gray-400 hover:text-white text-2xl">&times;</button>
                    </div>
                    <form id="memory-form" onsubmit="saveMemory(event)">
                        <input type="hidden" id="memory-id">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">Content *</label>
                                <textarea id="memory-content" rows="4" required
                                          class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white"
                                          placeholder="Enter the memory content..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-1">Summary</label>
                                <input type="text" id="memory-summary"
                                       class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white"
                                       placeholder="Brief summary (auto-generated if empty)">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Scope *</label>
                                    <select id="memory-scope" required class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                                        <option value="owner">Owner</option>
                                        <option value="guest">Guest</option>
                                        <option value="global">Global</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Category</label>
                                    <select id="memory-category" class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                                        <option value="">None</option>
                                        <option value="preference">Preference</option>
                                        <option value="fact">Fact</option>
                                        <option value="interaction">Interaction</option>
                                        <option value="request">Request</option>
                                        <option value="feedback">Feedback</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Importance (0-1)</label>
                                    <input type="number" id="memory-importance" min="0" max="1" step="0.1" value="0.5"
                                           class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Guest Session</label>
                                    <select id="memory-guest-session" class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                                        <option value="">No Session</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end gap-3">
                            <button type="button" onclick="closeMemoryModal()"
                                    class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-medium transition-colors">
                                Cancel
                            </button>
                            <button type="submit"
                                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                                Save Memory
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Guest Mode Tab -->
            <div id="tab-guest-mode" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Guest Mode Management</h2>
                    <div class="flex gap-2">
                        <!-- Test Mode Toggle -->
                        <label class="flex items-center gap-2 px-4 py-2 bg-yellow-600/20 border border-yellow-600/50 rounded-lg cursor-pointer">
                            <input type="checkbox" id="guest-test-mode" onchange="toggleGuestTestMode()" class="rounded">
                            <span class="text-yellow-400 text-sm font-medium">Test Mode</span>
                        </label>
                        <!-- Clear Test Data Button (only visible in test mode) -->
                        <button id="clear-test-data-btn" onclick="clearTestData()"
                            class="hidden px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors">
                            Clear Test Data
                        </button>
                        <button onclick="showAddGuestModal()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            ➕ Add Guest
                        </button>
                        <button onclick="loadGuestModeData()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Status Banner -->
                <div id="guest-mode-status-banner" class="mb-6">
                    <!-- Dynamic status banner will be inserted here -->
                </div>

                <!-- Current/Upcoming Guests Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Current Guests -->
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                            <span class="text-green-400">●</span>
                            Current Guests
                        </h3>
                        <div id="current-guests-container">
                            <div class="text-center text-gray-400 py-4">
                                <p>Loading current guests...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Guests -->
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                            <span class="text-blue-400">◐</span>
                            Upcoming Guests
                            <select id="upcoming-days" onchange="loadUpcomingGuests()" class="ml-auto px-2 py-1 bg-dark-bg border border-dark-border rounded text-sm">
                                <option value="7">7 days</option>
                                <option value="14">14 days</option>
                                <option value="30" selected>30 days</option>
                                <option value="90">90 days</option>
                            </select>
                        </h3>
                        <div id="upcoming-guests-container">
                            <div class="text-center text-gray-400 py-4">
                                <p>Loading upcoming guests...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Guest History Section -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">Guest History</h3>
                        <div class="flex gap-4 items-center">
                            <input type="text" id="guest-search" placeholder="Search by name..."
                                onkeyup="filterGuestHistory()"
                                class="px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm w-48">
                            <label class="flex items-center gap-2 text-sm text-gray-400">
                                <input type="checkbox" id="show-deleted-guests" onchange="loadGuestHistory()" class="rounded">
                                <span>Show Deleted</span>
                            </label>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="crud-table">
                            <thead>
                                <tr>
                                    <th>Guest Name</th>
                                    <th>Check-in</th>
                                    <th>Check-out</th>
                                    <th>Contact</th>
                                    <th>Source</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="guest-history-table-body">
                                <tr>
                                    <td colspan="7" class="text-center text-gray-400 py-8">
                                        <div class="text-2xl mb-2">🏠</div>
                                        <p>Loading guest history...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div id="guest-history-pagination" class="flex justify-between items-center mt-4 pt-4 border-t border-dark-border">
                        <div class="text-sm text-gray-400">
                            <span id="guest-history-count">0</span> entries
                        </div>
                        <div class="flex gap-2">
                            <button id="prev-page-btn" onclick="loadGuestHistory(guestHistoryOffset - guestHistoryLimit)"
                                class="px-3 py-1 bg-dark-bg border border-dark-border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                ← Previous
                            </button>
                            <button id="next-page-btn" onclick="loadGuestHistory(guestHistoryOffset + guestHistoryLimit)"
                                class="px-3 py-1 bg-dark-bg border border-dark-border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                Next →
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar Sources Tab -->
            <div id="tab-calendar-sources" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Calendar Sources</h2>
                    <div class="flex gap-2">
                        <button onclick="syncAllCalendarSources()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                            Sync All
                        </button>
                        <button onclick="showCreateCalendarSourceModal()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            + Add Source
                        </button>
                        <button onclick="loadCalendarSources()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-medium transition-colors">
                            Refresh
                        </button>
                    </div>
                </div>

                <!-- Description Banner -->
                <div class="bg-blue-900/30 border border-blue-700 rounded-lg p-4 mb-6">
                    <div class="flex items-start gap-3">
                        <span class="text-2xl">📅</span>
                        <div>
                            <p class="text-blue-300 font-medium">Automatic Calendar Sync</p>
                            <p class="text-blue-200/70 text-sm mt-1">
                                Connect your vacation rental calendar feeds from Airbnb, VRBO, Lodgify, or any iCal-compatible service.
                                Guest reservations will be automatically synced and used to enable Guest Mode during stays.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Calendar Sources Container -->
                <div id="calendar-sources-container" class="space-y-4"></div>
            </div>

            <!-- Voice Automations Tab -->
            <div id="tab-voice-automations" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Voice Automations</h2>
                    <p class="text-gray-400 text-sm">Manage voice-created automations and guest session lifecycle</p>
                </div>
                <div id="automations-container">
                    <div class="text-center text-gray-400 py-8">
                        <p>Loading voice automations...</p>
                    </div>
                </div>
            </div>

            <!-- SMS Messaging Tab -->
            <div id="tab-sms" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">SMS Messaging</h2>
                    <div class="flex gap-2">
                        <button onclick="loadSMSData()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- SMS Settings Section -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                        <span class="text-blue-400">⚙️</span>
                        SMS Settings
                    </h3>

                    <div id="sms-settings-container">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Left Column: Twilio Config -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Twilio Account SID</label>
                                    <input type="text" id="sms-account-sid" placeholder="ACxxxxxxxx..."
                                        class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Twilio Auth Token</label>
                                    <input type="password" id="sms-auth-token" placeholder="Enter auth token..."
                                        class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">From Phone Number</label>
                                    <input type="text" id="sms-from-number" placeholder="+1234567890"
                                        class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm">
                                </div>
                            </div>

                            <!-- Right Column: Feature Toggles -->
                            <div class="space-y-4">
                                <label class="flex items-center gap-3 p-3 bg-dark-bg rounded-lg cursor-pointer">
                                    <input type="checkbox" id="sms-enabled" class="rounded">
                                    <div>
                                        <div class="text-sm font-medium text-white">Enable SMS</div>
                                        <div class="text-xs text-gray-400">Master toggle for all SMS features</div>
                                    </div>
                                </label>
                                <label class="flex items-center gap-3 p-3 bg-dark-bg rounded-lg cursor-pointer">
                                    <input type="checkbox" id="sms-auto-detect" class="rounded">
                                    <div>
                                        <div class="text-sm font-medium text-white">Auto-detect Textable Content</div>
                                        <div class="text-xs text-gray-400">Detect WiFi, codes, addresses automatically</div>
                                    </div>
                                </label>
                                <label class="flex items-center gap-3 p-3 bg-dark-bg rounded-lg cursor-pointer">
                                    <input type="checkbox" id="sms-test-mode" class="rounded">
                                    <div>
                                        <div class="text-sm font-medium text-white">Test Mode</div>
                                        <div class="text-xs text-gray-400">Log SMS without sending (development)</div>
                                    </div>
                                </label>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Rate Limit (per hour)</label>
                                    <input type="number" id="sms-rate-limit" placeholder="10" min="1" max="100"
                                        class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm">
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 flex justify-end gap-3">
                            <button onclick="testSMSConnection()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-medium transition-colors">
                                🧪 Test Connection
                            </button>
                            <button onclick="saveSMSSettings()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors">
                                💾 Save Settings
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Cost Tracking Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Monthly Summary -->
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                            <span class="text-green-400">💰</span>
                            Monthly SMS Costs
                        </h3>
                        <div id="sms-cost-summary" class="space-y-3">
                            <div class="text-center text-gray-400 py-4">
                                <p>Loading cost data...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Per-Stay Costs -->
                    <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                            <span class="text-purple-400">🏠</span>
                            Costs by Stay
                        </h3>
                        <div id="sms-cost-by-stay" class="space-y-2 max-h-64 overflow-y-auto">
                            <div class="text-center text-gray-400 py-4">
                                <p>Loading stay costs...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SMS History Section -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white">SMS History</h3>
                        <div class="flex gap-4 items-center">
                            <select id="sms-history-filter" onchange="loadSMSHistory()" class="px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm">
                                <option value="">All Messages</option>
                                <option value="sent">Sent</option>
                                <option value="delivered">Delivered</option>
                                <option value="failed">Failed</option>
                            </select>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="crud-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Recipient</th>
                                    <th>Type</th>
                                    <th>Content Preview</th>
                                    <th>Status</th>
                                    <th>Cost</th>
                                </tr>
                            </thead>
                            <tbody id="sms-history-table-body">
                                <tr>
                                    <td colspan="6" class="text-center text-gray-400 py-8">
                                        <div class="text-2xl mb-2">📱</div>
                                        <p>Loading SMS history...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div id="sms-history-pagination" class="flex justify-between items-center mt-4 pt-4 border-t border-dark-border">
                        <div class="text-sm text-gray-400">
                            <span id="sms-history-count">0</span> messages
                        </div>
                        <div class="flex gap-2">
                            <button id="sms-prev-page-btn" onclick="loadSMSHistory(smsHistoryOffset - smsHistoryLimit)"
                                class="px-3 py-1 bg-dark-bg border border-dark-border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                ← Previous
                            </button>
                            <button id="sms-next-page-btn" onclick="loadSMSHistory(smsHistoryOffset + smsHistoryLimit)"
                                class="px-3 py-1 bg-dark-bg border border-dark-border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                Next →
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Manual SMS Send Section -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mt-6">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                        <span class="text-yellow-400">✉️</span>
                        Send Test SMS
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number</label>
                            <input type="text" id="sms-test-to" placeholder="+1234567890"
                                class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Message</label>
                            <input type="text" id="sms-test-message" placeholder="Test message content..."
                                class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white text-sm">
                        </div>
                    </div>
                    <div class="mt-4">
                        <button onclick="sendTestSMS()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            📤 Send Test SMS
                        </button>
                    </div>
                </div>

                <!-- SMS Templates Section -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white flex items-center gap-2">
                            <span class="text-blue-400">📝</span>
                            SMS Templates
                        </h3>
                        <button onclick="showAddTemplateModal()" class="px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm">
                            + Add Template
                        </button>
                    </div>
                    <div id="sms-templates-container" class="space-y-3">
                        <div class="text-center text-gray-400 py-4">
                            <p>Loading templates...</p>
                        </div>
                    </div>
                </div>

                <!-- Scheduled SMS Section -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white flex items-center gap-2">
                            <span class="text-purple-400">⏰</span>
                            Scheduled Messages
                        </h3>
                        <button onclick="showAddScheduledModal()" class="px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm">
                            + Add Schedule
                        </button>
                    </div>
                    <div id="scheduled-sms-container" class="space-y-3">
                        <div class="text-center text-gray-400 py-4">
                            <p>Loading scheduled messages...</p>
                        </div>
                    </div>
                </div>

                <!-- Tips Configuration Section -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-white flex items-center gap-2">
                            <span class="text-yellow-400">💡</span>
                            Guest Tips
                        </h3>
                        <button onclick="showAddTipModal()" class="px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm">
                            + Add Tip
                        </button>
                    </div>
                    <div id="tips-container" class="space-y-3">
                        <div class="text-center text-gray-400 py-4">
                            <p>Loading tips...</p>
                        </div>
                    </div>
                </div>

                <!-- Incoming SMS Log Section -->
                <div class="bg-dark-card border border-dark-border rounded-lg p-6 mt-6">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                        <span class="text-green-400">📥</span>
                        Incoming Messages
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="crud-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>From</th>
                                    <th>Message</th>
                                    <th>Guest</th>
                                    <th>Response</th>
                                </tr>
                            </thead>
                            <tbody id="incoming-sms-table-body">
                                <tr>
                                    <td colspan="5" class="text-center text-gray-400 py-8">
                                        <div class="text-2xl mb-2">📥</div>
                                        <p>No incoming messages yet</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- LLM Components Tab -->
            <div id="tab-llm-components" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">LLM Component Configuration</h2>
                    <div class="flex gap-2 items-center">
                        <span id="llm-components-last-refresh" class="text-sm text-gray-400"></span>
                        <button onclick="refreshAvailableModels()"
                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh Models
                        </button>
                    </div>
                </div>

                <!-- Auto-refresh indicator -->
                <div class="mb-4 p-3 bg-dark-card border border-dark-border rounded-lg flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="text-green-400">●</span>
                        <span class="text-sm text-gray-400">Auto-refresh: Every 5 minutes</span>
                    </div>
                    <div class="text-sm text-gray-400">
                        Available Models: <span id="available-models-count" class="text-white font-medium">-</span>
                    </div>
                </div>

                <!-- MLX Backend Summary -->
                <div id="mlx-summary-container"></div>

                <!-- Components by Category -->
                <div id="llm-components-orchestrator" class="mb-6">
                    <h3 class="text-lg font-medium text-white mb-3">Orchestrator Components</h3>
                    <div id="orchestrator-components-table" class="bg-dark-card border border-dark-border rounded-lg overflow-hidden">
                        <div class="text-center text-gray-400 py-8">Loading...</div>
                    </div>
                </div>

                <div id="llm-components-validation" class="mb-6">
                    <h3 class="text-lg font-medium text-white mb-3">Validation Components</h3>
                    <div id="validation-components-table" class="bg-dark-card border border-dark-border rounded-lg overflow-hidden">
                        <div class="text-center text-gray-400 py-8">Loading...</div>
                    </div>
                </div>

                <div id="llm-components-control" class="mb-6">
                    <h3 class="text-lg font-medium text-white mb-3">Control Components</h3>
                    <div id="control-components-table" class="bg-dark-card border border-dark-border rounded-lg overflow-hidden">
                        <div class="text-center text-gray-400 py-8">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Service Control Tab -->
            <div id="tab-service-control" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Service Control</h2>
                    <div class="flex gap-2">
                        <button onclick="refreshServiceStatus()"
                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4 inline"></i> Refresh Status
                        </button>
                    </div>
                </div>

                <!-- Service Status Summary -->
                <div class="grid grid-cols-4 gap-4 mb-6">
                    <div class="bg-dark-card border border-dark-border rounded-lg p-4">
                        <div class="text-2xl font-bold text-green-400" id="services-running-count">-</div>
                        <div class="text-sm text-gray-400">Running</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-4">
                        <div class="text-2xl font-bold text-red-400" id="services-stopped-count">-</div>
                        <div class="text-sm text-gray-400">Stopped</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-4">
                        <div class="text-2xl font-bold text-blue-400" id="ollama-models-loaded">-</div>
                        <div class="text-sm text-gray-400">Models Loaded</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-lg p-4">
                        <div class="text-2xl font-bold text-gray-400" id="ollama-models-total">-</div>
                        <div class="text-sm text-gray-400">Models Available</div>
                    </div>
                </div>

                <!-- Ollama Status Panel -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium text-white mb-3">Ollama LLM Server</h3>
                    <div id="ollama-status-panel" class="bg-dark-card border border-dark-border rounded-lg overflow-hidden">
                        <div class="text-center text-gray-400 py-8">Loading Ollama status...</div>
                    </div>
                </div>

                <!-- Ollama Models -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium text-white mb-3">Ollama Models</h3>
                    <div id="ollama-models-table" class="bg-dark-card border border-dark-border rounded-lg overflow-hidden">
                        <div class="text-center text-gray-400 py-8">Loading...</div>
                    </div>
                </div>

                <!-- Core Services -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium text-white mb-3">Core Services</h3>
                    <div id="core-services-table" class="bg-dark-card border border-dark-border rounded-lg overflow-hidden">
                        <div class="text-center text-gray-400 py-8">Loading...</div>
                    </div>
                </div>

                <!-- RAG Services -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium text-white mb-3">RAG Services</h3>
                    <div id="rag-services-table" class="bg-dark-card border border-dark-border rounded-lg overflow-hidden">
                        <div class="text-center text-gray-400 py-8">Loading...</div>
                    </div>
                </div>

                <!-- Infrastructure -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium text-white mb-3">Infrastructure</h3>
                    <div id="infrastructure-services-table" class="bg-dark-card border border-dark-border rounded-lg overflow-hidden">
                        <div class="text-center text-gray-400 py-8">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Gateway Settings Tab -->
            <div id="tab-gateway-settings" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Gateway Settings</h2>
                    <button onclick="loadGatewayConfig()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors">
                        Refresh
                    </button>
                </div>
                <div class="bg-blue-900/20 border border-blue-700/50 rounded-lg p-4 mb-6">
                    <p class="text-blue-200 text-sm">Changes take effect within 60 seconds as the gateway refreshes its configuration cache.</p>
                </div>
                <div id="gateway-settings-container">
                    <div class="text-center text-gray-400 py-8">Loading gateway settings...</div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals Container -->
    <div id="modals-container"></div>

    <!-- Tooltip Container -->
    <div id="tooltip-container"></div>

    <!-- Base Knowledge Modal -->
    <div id="knowledge-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50" onclick="closeKnowledgeModal(event)">
        <div class="bg-dark-card border border-dark-border rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-white" id="knowledge-modal-title">Add Base Knowledge Entry</h3>
                <button onclick="closeKnowledgeModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>

            <form id="knowledge-form" onsubmit="saveKnowledge(event)" class="space-y-4">
                <input type="hidden" id="knowledge-id">

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Category *</label>
                    <select id="knowledge-category" required class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                        <option value="property">Property</option>
                        <option value="location">Location</option>
                        <option value="user">User Context</option>
                        <option value="temporal">Temporal</option>
                        <option value="general">General</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Key *</label>
                    <input type="text" id="knowledge-key" required placeholder="e.g., address, user_type, current_date" class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Value *</label>
                    <textarea id="knowledge-value" required rows="3" placeholder="The actual knowledge content. Use {dynamic:current_date} or {dynamic:current_time} for dynamic values." class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white"></textarea>
                    <p class="text-xs text-gray-500 mt-1">Tip: Use {dynamic:current_date} or {dynamic:current_time} for dynamic placeholders</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Applies To *</label>
                    <select id="knowledge-applies-to" required class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                        <option value="both">Both Guest & Owner</option>
                        <option value="guest">Guest Only</option>
                        <option value="owner">Owner Only</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Priority</label>
                    <input type="number" id="knowledge-priority" value="0" class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                    <p class="text-xs text-gray-500 mt-1">Higher priority entries appear first in context (default: 0)</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Description</label>
                    <input type="text" id="knowledge-description" placeholder="Optional description for internal reference" class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                </div>

                <div>
                    <label class="flex items-center gap-2 text-sm text-gray-400">
                        <input type="checkbox" id="knowledge-enabled" checked class="rounded">
                        <span>Enabled</span>
                    </label>
                </div>

                <div class="flex gap-3 pt-4">
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                        Save Entry
                    </button>
                    <button type="button" onclick="closeKnowledgeModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Guest Entry Modal -->
    <div id="guest-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50" onclick="closeGuestModal(event)">
        <div class="bg-dark-card border border-dark-border rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-white" id="guest-modal-title">Add Guest Entry</h3>
                <button onclick="closeGuestModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>

            <form id="guest-form" onsubmit="saveGuestEntry(event)" class="space-y-4">
                <input type="hidden" id="guest-entry-id">
                <input type="hidden" id="guest-entry-source">

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Guest Name *</label>
                        <input type="text" id="guest-name" required placeholder="e.g., John Smith"
                            class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Status</label>
                        <select id="guest-status" class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                            <option value="confirmed">Confirmed</option>
                            <option value="pending">Pending</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Check-in Date *</label>
                        <input type="datetime-local" id="guest-checkin" required
                            class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Check-out Date *</label>
                        <input type="datetime-local" id="guest-checkout" required
                            class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Email</label>
                        <input type="email" id="guest-email" placeholder="guest@example.com"
                            class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Phone</label>
                        <input type="tel" id="guest-phone" placeholder="+1 555-123-4567"
                            class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Notes</label>
                    <textarea id="guest-notes" rows="3" placeholder="Special requests, arrival time, etc."
                        class="w-full px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-white"></textarea>
                </div>

                <div>
                    <label class="flex items-center gap-2 text-sm text-gray-400">
                        <input type="checkbox" id="guest-is-test" class="rounded">
                        <span>Test Data</span>
                        <span class="text-xs text-gray-500">(will be auto-cleared when real guests overlap)</span>
                    </label>
                </div>

                <div id="guest-form-ical-warning" class="hidden p-3 bg-yellow-900/20 border border-yellow-700/50 rounded-lg">
                    <p class="text-yellow-200 text-sm">
                        ⚠️ This is an iCal-synced entry. Only notes and status can be edited.
                    </p>
                </div>

                <div class="flex gap-3 pt-4">
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                        Save Guest Entry
                    </button>
                    <button type="button" onclick="closeGuestModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Guest to Reservation Modal -->
    <div id="add-guest-to-reservation-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50" onclick="closeAddGuestToReservationModal()">
        <div class="bg-dark-card border border-dark-border rounded-lg p-6 max-w-md w-full mx-4" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-white">Add Guest to Reservation</h3>
                <button onclick="closeAddGuestToReservationModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>

            <form onsubmit="saveGuestToReservation(event)" class="space-y-4">
                <input type="hidden" id="add-guest-event-id">

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Guest Name *</label>
                    <input type="text" id="new-guest-name-for-reservation" required
                        class="w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Email</label>
                    <input type="email" id="new-guest-email-for-reservation"
                        class="w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Phone</label>
                    <input type="tel" id="new-guest-phone-for-reservation"
                        class="w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none">
                </div>

                <div class="flex gap-3 pt-4">
                    <button type="submit" class="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors">
                        Add Guest
                    </button>
                    <button type="button" onclick="closeAddGuestToReservationModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Guest Selection Modal (for multi-guest identification) -->
    <div id="guest-selection-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-dark-card border border-dark-border rounded-lg p-6 max-w-md w-full mx-4 shadow-xl">
            <h2 class="text-xl font-bold text-white mb-2">Welcome!</h2>
            <p class="text-gray-400 mb-4">Who are you?</p>
            <div id="guest-list" class="space-y-2 mb-4">
                <!-- Populated by JavaScript -->
            </div>
            <button id="btn-add-new-guest" class="w-full bg-dark-accent text-white py-2 px-4 rounded hover:bg-dark-accent/80 transition-colors">
                I'm someone else
            </button>
        </div>
    </div>

    <!-- Add New Guest Modal -->
    <div id="add-guest-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-dark-card border border-dark-border rounded-lg p-6 max-w-md w-full mx-4 shadow-xl">
            <h2 class="text-xl font-bold text-white mb-4">Add Your Name</h2>
            <form id="add-guest-form" class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Name *</label>
                    <input type="text" id="new-guest-name" required
                        class="w-full bg-dark-bg border border-dark-border rounded px-3 py-2 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Email (optional)</label>
                    <input type="email" id="new-guest-email"
                        class="w-full bg-dark-bg border border-dark-border rounded px-3 py-2 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Phone (optional)</label>
                    <input type="tel" id="new-guest-phone"
                        class="w-full bg-dark-bg border border-dark-border rounded px-3 py-2 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none">
                </div>
                <div class="flex gap-2 pt-2">
                    <button type="submit" class="flex-1 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors">
                        Save
                    </button>
                    <button type="button" onclick="hideAddGuestModal()"
                        class="flex-1 bg-gray-600 text-white py-2 px-4 rounded hover:bg-gray-700 transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- FingerprintJS for device identification -->
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@4/dist/fp.min.js"></script>

    <!-- Phase 0: Core State & API Infrastructure (MUST load first) -->
    <script src="/state.js?v=20260107"></script>
    <script src="/api-client.js?v=20260107"></script>
    <script src="/auth.js?v=20260107"></script>
    <script src="/refresh-manager.js?v=20260107"></script>

    <!-- Phase 1-7: UI Components -->
    <script src="/router.js?v=20260107"></script>
    <script src="/status-bar.js?v=20260107"></script>
    <script src="/icons.js?v=20260107"></script>
    <script src="/skeleton.js?v=20260107"></script>
    <script src="/command-palette.js?v=20260107"></script>

    <!-- Shared utilities module - must load before other scripts -->
    <script src="/utils.js?v=20260112"></script>
    <script src="/user-api-keys.js?v=20260112"></script>

    <!-- Athena UI Framework -->
    <script src="/athena.js?v=20260108"></script>
    <script src="/charts.js?v=20260108"></script>
    <script src="/toast.js?v=20260108"></script>
    <script src="/drawer.js?v=20260108"></script>
    <script src="/activity-sidebar.js?v=20260108"></script>
    <script src="/mission-control.js?v=20260108"></script>
    <script src="/voice-pipelines.js?v=20260113"></script>
    <script src="/memory-context.js?v=20260108"></script>
    <script src="/integrations.js?v=20260108"></script>
    <script src="/keyboard.js?v=20260108"></script>

    <script src="/app.js?v=20260108"></script>
    <script src="/crud-extensions.js"></script>
    <script src="/conversation.js"></script>
    <script src="/routing.js?v=20260112"></script>
    <script src="/metrics.js"></script>
    <script src="/analytics.js"></script>
    <script src="/features.js"></script>
    <script src="/tool-calling.js"></script>
    <script src="/escalation.js"></script>
    <script src="/debug-logs.js"></script>
    <script src="/base-knowledge.js"></script>
    <script src="/guest-mode.js"></script>
    <script src="/sms.js"></script>
    <script src="/llm-components.js"></script>
    <script src="/model-config.js"></script>
    <script src="/model-downloads.js"></script>
    <script src="/cloud-providers.js?v=20260112"></script>
    <script src="/service-bypass.js"></script>
    <script src="/service-control.js"></script>
    <script src="/gateway-settings.js"></script>
    <script src="/room-groups.js"></script>
    <script src="/guest-context.js"></script>
    <script src="/calendar-sources.js"></script>
    <script src="/memory-management.js"></script>
    <script src="/directions-settings.js"></script>
    <script src="/emerging-intents.js"></script>
    <script src="/music-config.js"></script>
    <script src="/room-audio.js"></script>
    <script src="/room-tv.js"></script>
    <script src="/follow-me.js"></script>
    <script src="/voice-config.js?v=20260112"></script>
    <script src="/admin-jarvis.js"></script>
    <script src="/site-scraper.js"></script>
    <script src="/system-config.js"></script>
    <script src="/presets.js"></script>
    <script src="/voice-automations.js"></script>
    <script src="/alerts.js?v=20260112"></script>
</body>
</html>
